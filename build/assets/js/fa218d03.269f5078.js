"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3164],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>f});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var c=n.createContext({}),s=function(e){var t=n.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},p=function(e){var t=s(e.components);return n.createElement(c.Provider,{value:t},e.children)},m="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,c=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),m=s(a),h=r,f=m["".concat(c,".").concat(h)]||m[h]||d[h]||i;return a?n.createElement(f,o(o({ref:t},p),{},{components:a})):n.createElement(f,o({ref:t},p))}));function f(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=h;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l[m]="string"==typeof e?e:r,o[1]=l;for(var s=2;s<i;s++)o[s]=a[s];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},8844:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>l,toc:()=>s});var n=a(7462),r=(a(7294),a(3905));const i={sidebar_position:1,id:"Certificate Management for ADFS, WAP and Exchange",title:"Certificate Management for ADFS, WAP and Exchange",tags:["KB","Certificates","Windows Server","ADFS","WAP","Exchange"]},o=void 0,l={unversionedId:"Articles/Windows Server/Certificate Management for ADFS, WAP and Exchange",id:"Articles/Windows Server/Certificate Management for ADFS, WAP and Exchange",title:"Certificate Management for ADFS, WAP and Exchange",description:"This article assumes you're using an External Certificate Authority.",source:"@site/docs/Articles/Windows Server/Replace ADFS, WAP and Exch Certs.md",sourceDirName:"Articles/Windows Server",slug:"/Articles/Windows Server/Certificate Management for ADFS, WAP and Exchange",permalink:"/Articles/Windows Server/Certificate Management for ADFS, WAP and Exchange",draft:!1,tags:[{label:"KB",permalink:"/tags/kb"},{label:"Certificates",permalink:"/tags/certificates"},{label:"Windows Server",permalink:"/tags/windows-server"},{label:"ADFS",permalink:"/tags/adfs"},{label:"WAP",permalink:"/tags/wap"},{label:"Exchange",permalink:"/tags/exchange"}],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,id:"Certificate Management for ADFS, WAP and Exchange",title:"Certificate Management for ADFS, WAP and Exchange",tags:["KB","Certificates","Windows Server","ADFS","WAP","Exchange"]},sidebar:"tutorialSidebar",previous:{title:"Windows Server",permalink:"/category/windows-server"},next:{title:"Guides",permalink:"/category/guides"}},c={},s=[{value:"Generate a new CSR",id:"generate-a-new-csr",level:2},{value:"Replacement steps",id:"replacement-steps",level:2},{value:"Replacing the ADFS certificate",id:"replacing-the-adfs-certificate",level:3},{value:"Replacing the SSL certificate for the Web Application Proxy",id:"replacing-the-ssl-certificate-for-the-web-application-proxy",level:3},{value:"Replace the certificate for Exchange 2016",id:"replace-the-certificate-for-exchange-2016",level:3},{value:"Testing",id:"testing",level:2},{value:"Exchange",id:"exchange",level:3},{value:"ADFSWAP",id:"adfswap",level:3}],p={toc:s};function m(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("admonition",{title:"Before you start",type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"This article assumes you're using an External Certificate Authority.")),(0,r.kt)("h2",{id:"generate-a-new-csr"},"Generate a new CSR"),(0,r.kt)("p",null,"From a server with IIS installed."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Open IIS")," (or Internet Information Services (IIS) Manager)."),(0,r.kt)("li",{parentName:"ol"},"Select the server name from the connections list."),(0,r.kt)("li",{parentName:"ol"},"Click on the ",(0,r.kt)("strong",{parentName:"li"},"Server Certificates")," option."),(0,r.kt)("li",{parentName:"ol"},"On the right-hand side, click ",(0,r.kt)("strong",{parentName:"li"},"Create Certificate Request"),"."),(0,r.kt)("li",{parentName:"ol"},"Fill in the informaiton using the Wizard as accurately as possible.")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"}," The Common Name: This should match the domain you want the Certifiacte to cover.")),(0,r.kt)("ol",{start:6},(0,r.kt)("li",{parentName:"ol"},"Select 2048 for the encryption, I've never used anything less than this."),(0,r.kt)("li",{parentName:"ol"},"Complete the wizard and save the CSR with a sensible name.")),(0,r.kt)("p",null,"Take this CSR to your chosen external certificate provider, DigiCert for example. Enter your CSR and they'll send you back a certificate file in many formats."),(0,r.kt)("h2",{id:"replacement-steps"},"Replacement steps"),(0,r.kt)("h3",{id:"replacing-the-adfs-certificate"},"Replacing the ADFS certificate"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/windows-server/identity/ad-fs/operations/manage-ssl-certificates-ad-fs-wap#replacing-the-ssl-certificate-for-ad-fs-running-in-default-certificate-authentication-binding-mode"},"Microsoft doc link."),"."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"The certificate thumbprint can be found by executing this command, ",(0,r.kt)("inlineCode",{parentName:"p"},"dir Cert:\\LocalMachine\\My\\"),".")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Import the cert to the Local Machine store."),(0,r.kt)("li",{parentName:"ol"},"Open PowerShell as an Admin."),(0,r.kt)("li",{parentName:"ol"},"Run the command, ",(0,r.kt)("inlineCode",{parentName:"li"},"Set-AdfsSslCertificate -Thumbprint '<thumbprint of new cert>'"),".")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"The Set-AdfsSslCertificate cmdlet is a multi-node cmdlet; this means it only has to run from the primary and all nodes in the farm will be updated. This is new in Server 2016, all servers in you setup must be running 2016.")),(0,r.kt)("h3",{id:"replacing-the-ssl-certificate-for-the-web-application-proxy"},"Replacing the SSL certificate for the Web Application Proxy"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/windows-server/identity/ad-fs/operations/manage-ssl-certificates-ad-fs-wap#replacing-the-ssl-certificate-for-the-web-application-proxy"},"Microsoft doc link."),"."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Import the cert to the Local Machine store."),(0,r.kt)("li",{parentName:"ol"},"Open PowerShell as an Admin."),(0,r.kt)("li",{parentName:"ol"},"Run the command, ",(0,r.kt)("inlineCode",{parentName:"li"},"Set-WebApplicationProxySslCertificate -Thumbprint '<thumbprint of new cert>'"),".")),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"If the above cmdlet fails because the old certificate has already expired, reconfigure the proxy using the following cmdlets:"),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},"$cred = Get-Credential\nInstall-WebApplicationProxy -FederationServiceTrustCredential $cred -CertificateThumbprint '<thumbprint of new cert>' -FederationServiceName 'fs.contoso.com'\n"))),(0,r.kt)("h3",{id:"replace-the-certificate-for-exchange-2016"},"Replace the certificate for Exchange 2016"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Import the cert to the Local Machine store."),(0,r.kt)("li",{parentName:"ol"},"Open the ",(0,r.kt)("strong",{parentName:"li"},"EAC")," and navigate to ",(0,r.kt)("strong",{parentName:"li"},"Servers > Certificates"),"."),(0,r.kt)("li",{parentName:"ol"},"In the Select server list, ",(0,r.kt)("strong",{parentName:"li"},"select the Exchange server")," where you want to install the certificate, click ",(0,r.kt)("strong",{parentName:"li"},"More options"),", and select ",(0,r.kt)("strong",{parentName:"li"},"Import Exchange certificate"),"."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Follow the Wizard")," to import the certificate."),(0,r.kt)("li",{parentName:"ol"},"In the Specify the servers you want to apply this certificate to page, ",(0,r.kt)("strong",{parentName:"li"},"click Add"),"."),(0,r.kt)("li",{parentName:"ol"},"On the Select a server page that opens, ",(0,r.kt)("strong",{parentName:"li"},"select the Exchange server")," where you want to install the certificate, and ",(0,r.kt)("strong",{parentName:"li"},"click Add"),".")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Repeat this step as many times as necessary. ")),(0,r.kt)("ol",{start:7},(0,r.kt)("li",{parentName:"ol"},"When you're finished selecting servers, ",(0,r.kt)("strong",{parentName:"li"},"click OK"),".")),(0,r.kt)("h2",{id:"testing"},"Testing"),(0,r.kt)("h3",{id:"exchange"},"Exchange"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Open the webmail console and review the certificate presented. This should be the new certificate.")),(0,r.kt)("h3",{id:"adfswap"},"ADFS\\WAP"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Load the ADFS web page and review the certificate presented. This should be the new certificate. "),(0,r.kt)("li",{parentName:"ol"},"If required the customer can test by, any app\\device that requires them to sign-in to Office 365.",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"Such as, Outlook, active-sync devices eg: ipad, mobile phones.")))))}m.isMDXComponent=!0}}]);