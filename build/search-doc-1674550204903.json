[{"title":"Approve or Block an App","type":0,"sectionRef":"#","url":"/Articles/Microsoft/Teams/Approve or Block an App","content":"","keywords":"IT  KnowledgeBase  Microsoft  Azure  Computers"},{"title":"1. Steps to complete​","type":1,"pageTitle":"Approve or Block an App","url":"/Articles/Microsoft/Teams/Approve or Block an App#1-steps-to-complete","content":"Login to Teams Admin Centre, https://admin.teams.microsoft.com/Click Teams Apps &gt; Manage apps.In the section towards the bottom of the page, search for the applicaton and select it.Click on Allow or Block in the action bar above the list. "},{"title":"Resource Creation Cheatsheet","type":0,"sectionRef":"#","url":"/Articles/Microsoft/Azure Resources Management/Resource Creation Cheatsheet","content":"","keywords":"IT  KnowledgeBase  Microsoft  Azure  Computers"},{"title":"Before you begin​","type":1,"pageTitle":"Resource Creation Cheatsheet","url":"/Articles/Microsoft/Azure Resources Management/Resource Creation Cheatsheet#before-you-begin","content":"info This information is down to personal experience and issues that I have come across when dealing with a customer requesting a new resource. Define the workload, this will help understand the size of the resource needed, consider growth over time as well.Costing, be prepared to provide estimates and justify the need to your solution; pay as you go is all well and good but, it can mount up quick.Consider dependancies before you starting the build, for example: Do you need a new Subscription?Do you need to create a Resources Group?Network Connectivity, do you need a private endpoint and network connectivity? Do you need people to connect externally to the resources? Monitoring and Alerting, what needs setting,?Backups, do you need them\\it?Security, what features need to be enabled?Resiliency, does the resource and depedant resources need to be resilient?Tags, tags are useful for billing, reporting and segregating resources. Suggested naming conventions here. Data Sovereignty, no good setting up resiliency to a region outside of the customer location if it's not allowed to be there!Estimate build time and get approval to create any resources.Testing, consider as well, how you will test out the build. Do you have test data to migrate as part of this work? "},{"title":"Other recommendations​","type":1,"pageTitle":"Resource Creation Cheatsheet","url":"/Articles/Microsoft/Azure Resources Management/Resource Creation Cheatsheet#other-recommendations","content":""},{"title":"Naming Conventions​","type":1,"pageTitle":"Resource Creation Cheatsheet","url":"/Articles/Microsoft/Azure Resources Management/Resource Creation Cheatsheet#naming-conventions","content":"tip The below bullet points apply to the Subsciption, Resource Group and the SQL resource. Almost nothing in Azure can be renamed after creation. You'll have to delete and start over. Names must be in lowercase, Azure does not support uppercase names. Name objects appropriately based on it's purpose. If it hosts production resources, include Production\\Prod in the name.If it hosts developement resources, include Development\\Dev in the name.If it hosts resources for a particular application or solution, include that app or solution name.Example naming convention, &quot;Company&quot;-&quot;environment type&quot;-&quot;Region&quot;-&quot;Resource information&quot;. "},{"title":"Size and Sku​","type":1,"pageTitle":"Resource Creation Cheatsheet","url":"/Articles/Microsoft/Azure Resources Management/Resource Creation Cheatsheet#size-and-sku","content":"Triple check the sizes available using the Azure portal, the Azure pricing calculator has no awareness of what is actaully available in a region. "},{"title":"Resource grouping​","type":1,"pageTitle":"Resource Creation Cheatsheet","url":"/Articles/Microsoft/Azure Resources Management/Resource Creation Cheatsheet#resource-grouping","content":"Resources within Resource Groups should share the same product life cycle.Many resources cannot be moved between groups after they've been created.Example naming convention, &quot;Company&quot;-&quot;environment type&quot;-&quot;Region&quot;-&quot;Resource information&quot;. "},{"title":"Monitoring​","type":1,"pageTitle":"Resource Creation Cheatsheet","url":"/Articles/Microsoft/Azure Resources Management/Resource Creation Cheatsheet#monitoring","content":"You can create Alerts in the Azure portal much like any other resource. You'll be required to pick from the &quot;suggested&quot; metrics. Microsoft docs link - Create alerts for Azure SQL Database.You can monitor SQL Databases with Azure Monitor, Microsoft docs link - Monitor Azure SQL Database with Azure Monitor. "},{"title":"Resource Specific Notes​","type":1,"pageTitle":"Resource Creation Cheatsheet","url":"/Articles/Microsoft/Azure Resources Management/Resource Creation Cheatsheet#resource-specific-notes","content":""},{"title":"Azure SQL Server and Database​","type":1,"pageTitle":"Resource Creation Cheatsheet","url":"/Articles/Microsoft/Azure Resources Management/Resource Creation Cheatsheet#azure-sql-server-and-database","content":"Authentication method, where apprproate, use both SQL and Azure AD, that covers both sides unless the user specifies otherwise.Network Connectivity, this can be a bit of a mess for SQL servers and Databases in Azure, I'd suggest digging into this a bit to see what fits best for your deplyment. By default, the databse\\sql server will be contactable by any resource in your Azure tenant provided it's not on a VNet already. External connectivity can be done through the network settings on the resource as is basically direct connect if no Private endpoint is setup. "},{"title":"Sending Logs to Log Analytics","type":0,"sectionRef":"#","url":"/Articles/Microsoft/Intune/Sending Logs to Log Analytics","content":"","keywords":"IT  KnowledgeBase  Microsoft  Azure  Computers"},{"title":"Logs that can be ingested​","type":1,"pageTitle":"Sending Logs to Log Analytics","url":"/Articles/Microsoft/Intune/Sending Logs to Log Analytics#logs-that-can-be-ingested","content":"Microsoft Intune includes built-in logs that provide information about your environment: Audit Logs shows a record of activities that generate a change in Intune, including create, update (edit), delete, assign, and remote actions.Operational Logs show details on users and devices that successfully (or failed) to enroll, and details on non-compliant devices.Device Compliance Organizational Logs show an organizational report for device compliance in Intune, and details on non-compliant devices.IntuneDevices show device inventory and status information for Intune enrolled and managed devices. "},{"title":"Notes​","type":1,"pageTitle":"Sending Logs to Log Analytics","url":"/Articles/Microsoft/Intune/Sending Logs to Log Analytics#notes","content":""},{"title":"Benefits​","type":1,"pageTitle":"Sending Logs to Log Analytics","url":"/Articles/Microsoft/Intune/Sending Logs to Log Analytics#benefits","content":"The main benefit of using Log Analytics is the visualisation, monitoring, and alerting on the connected data.Archive the data to review at a later date.Stream the logs into Azure Event hub for review in other 3rd party tools. "},{"title":"Cons (Sort of)​","type":1,"pageTitle":"Sending Logs to Log Analytics","url":"/Articles/Microsoft/Intune/Sending Logs to Log Analytics#cons-sort-of","content":"All of the above logs can be found within the Intune portal, login to EndPoint Manager (Intune) &gt; Devices &gt; Monitor. Audit Logs - login to EndPoint Manager (Intune) &gt; Devices &gt; Monitor &gt; Other &gt; Device actions.Operational Logs - login to EndPoint Manager (Intune) &gt; Devices &gt; Monitor &gt; Enrollment &gt; Enrollment Failures .and login to EndPoint Manager (Intune) &gt; Devices &gt; Monitor &gt; Compliance &gt; Noncompliant devices.Device Compliance Organizational Logs - login to EndPoint Manager (Intune) &gt; Reports &gt; Device compliance.IntuneDevices - login to EndPoint Manager (Intune) &gt; Devices &gt;All Devices. "},{"title":"Setup sending data​","type":1,"pageTitle":"Sending Logs to Log Analytics","url":"/Articles/Microsoft/Intune/Sending Logs to Log Analytics#setup-sending-data","content":"Microsoft link to instructions to set this up. "},{"title":"Cost estimations and Dependancies​","type":1,"pageTitle":"Sending Logs to Log Analytics","url":"/Articles/Microsoft/Intune/Sending Logs to Log Analytics#cost-estimations-and-dependancies","content":"Microsoft link - Storage size for activity logs. "},{"title":"Deploy Google Play store app","type":0,"sectionRef":"#","url":"/Articles/Microsoft/Intune/Deploy Google Play store app","content":"","keywords":"IT  KnowledgeBase  Microsoft  Azure  Computers"},{"title":"Add the App into Intune​","type":1,"pageTitle":"Deploy Google Play store app","url":"/Articles/Microsoft/Intune/Deploy Google Play store app#add-the-app-into-intune","content":"Login to https://endpoint.microsoft.com/Navigate to Apps &gt; Android &gt; Add App (Click the plus icon).Select the Managed Google Play app from the list.Search the app store.Find and select the app.Click Approve.Accept the agreement for what the application will have access to on the deice.For the next screen select one of the two options presented to you. For quality of life for your users, I'd select the top option &quot;Keep approved when app requests new permissions.&quot;  Click Sync in the top left corner of the screen. Go back the list of Android apps and you should see the new app appear shortly. "},{"title":"Creating a dynamic group to include only company owned android devices.​","type":1,"pageTitle":"Deploy Google Play store app","url":"/Articles/Microsoft/Intune/Deploy Google Play store app#creating-a-dynamic-group-to-include-only-company-owned-android-devices","content":"Login to, https://aad.portal.azure.com.Click on Azure Active Directory.Click Groups.Click New Group.Fill in the information, make sure to select Dynamic Device option under membership type. Click Add dynamic query at the bottom.Add the two queries below to check the OS device type and the device ownership properties. deviceOSType Equals AndroidEnterprise.deviceOwnership Equals Company.  "},{"title":"Take ownership of customer azure subscription","type":0,"sectionRef":"#","url":"/Articles/Microsoft/Microsoft Partner Centre/take ownership of customer azure subscription","content":"Take ownership of customer azure subscription Microsoft Article: Reinstate admin privileges for a customer's Azure CSP subscriptions. # Connect to Sub. Connect-AzAccount -TenantID &quot;&lt;Customer TenantID&gt;&quot; # Set the subscription context you want to add partner permissions too. Set-AzContext -SubscriptionID &quot;&lt;Customer Subscription ID&gt;&quot; # Assign the &quot;adminagents&quot; group in Partner tenant to the customer subscription New-AzRoleAssignment -ObjectID &quot;&lt;Object ID of the AdminAgents group from step 7 of your actions section&gt;&quot; -RoleDefinitionName &quot;Owner&quot; -Scope &quot;/subscriptions/&lt;CSP subscription ID&gt;&quot; -ObjectType &quot;ForeignGroup&quot; ","keywords":"IT  KnowledgeBase  Microsoft  Azure  Computers"},{"title":"Setup an Azure Subscription from Partner Centre","type":0,"sectionRef":"#","url":"/Articles/Microsoft/Microsoft Partner Centre/Setup an Azure Subscription from Partner Centre","content":"","keywords":"IT  KnowledgeBase  Microsoft  Azure  Computers"},{"title":"Before you begin​","type":1,"pageTitle":"Setup an Azure Subscription from Partner Centre","url":"/Articles/Microsoft/Microsoft Partner Centre/Setup an Azure Subscription from Partner Centre#before-you-begin","content":"Who'll manage this subscription? If it's being setup with the CSP in mind, it'll be the CSP. Who'll be supporting this subscription? Will it be added to BAU.What Groups and\\or accounts need to manage it, (Owner, Contributor, Reader). "},{"title":"Setup Process​","type":1,"pageTitle":"Setup an Azure Subscription from Partner Centre","url":"/Articles/Microsoft/Microsoft Partner Centre/Setup an Azure Subscription from Partner Centre#setup-process","content":"Microsoft Link. Sign in to the Azure portal using your Partner Center account.Make sure you are in your Partner Center directory (tenant), not a customer’s tenant.Navigate to Cost Management + Billing.Select the Billing scope for your billing account where the customer account resides.In the left menu under Billing, select Customers.On the Customers page, select the customer. If you have only one customer, the selection is unavailable.In the left menu, under Products + services, select All billing subscriptions.On the Azure subscription page, select + Add to create a subscription.Then select the type of subscription to add. For example, Usage based/ Azure subscription.On the Basics tab, enter a subscription name.Select the partner's billing account.Select the partner's billing profile.Select the customer that you're creating the subscription for and, if applicable, select a reseller.Next to Plan, select Microsoft Azure Plan for DevTest, if the subscription will be used for development or testing workloads. Otherwise, select Microsoft Azure Plan.Optionally, select the Tags tab and then enter tag pairs for Name and Value.Select Review + create. You should see a message stating Validation passed.Verify that the subscription information is correct, then select Create. You'll see a notification that the subscription is getting created. The customer will see the new subscription appear for them within 60 minutes, they may need to amend the subscription filter to see the new sub. If the end user you're testing with is not in the root managemnt group, you'll need to grant them a role over the Subscription before they can see it. "},{"title":"AutoPilot Reset","type":0,"sectionRef":"#","url":"/Articles/Microsoft/Intune/AutoPilot Reset","content":"","keywords":"IT  KnowledgeBase  Microsoft  Azure  Computers"},{"title":"Before you start​","type":1,"pageTitle":"AutoPilot Reset","url":"/Articles/Microsoft/Intune/AutoPilot Reset#before-you-start","content":"info Ignore this step if you know you do not use group tags. Confirm the device has the correct group tag Sometimes group tags within Autopilot are used to assign device profiles\\policies after the device has been enrolled. This group tag must be correct if you're using them otherwise, it'll interfer with the reset process. Login to Microsoft Endpoint Manager, https://endpoint.microsoft.com/.Click Devices &gt; Windows &gt; Windows Enrollment &gt; Devices.Find the Serial number of the device and search it here.Click on your device, alter group tag** here to the correct one.Click Save caution Wait for the profile status to change to assigned before progressing, this is automatic and in my experience can take up to 30 minutes. "},{"title":"Initiate the reset​","type":1,"pageTitle":"AutoPilot Reset","url":"/Articles/Microsoft/Intune/AutoPilot Reset#initiate-the-reset","content":"tip The Windows device MUST have a stable internet connection to complete this process. Login to Microsoft Endpoint Manager, https://endpoint.microsoft.com/.Click Devices &gt; Windows &gt; Windows Devices, it should already be on this option.Search for your device and click on the device name.Click the Autopilot Reset option.Click Yes. "},{"title":"On the device​","type":1,"pageTitle":"AutoPilot Reset","url":"/Articles/Microsoft/Intune/AutoPilot Reset#on-the-device","content":"Make sure the machine is powered on and connected to an internet source.The Autopilot process should start automatically.When the option appears, select Windows Autopilot provisioning. Autopilot should take over from here and reset the device. Once the above completes you should then be returned to a normal looking Windows login prompt. "},{"title":"Assign Managed Identity permissions","type":0,"sectionRef":"#","url":"/Articles/PowerShell/Assign Managed Identity permissions","content":"","keywords":"IT  KnowledgeBase  Microsoft  Azure  Computers"},{"title":"The command​","type":1,"pageTitle":"Assign Managed Identity permissions","url":"/Articles/PowerShell/Assign Managed Identity permissions#the-command","content":" # Your tenant id. $TenantID=&quot;Add your tenant ID&quot; # Microsoft Graph App ID (DON'T CHANGE). $GraphAppId = &quot;00000003-0000-0000-c000-000000000000&quot; # Name of the manage identity (same as the Logic App name). $DisplayNameOfMSI=&quot;Add display name of Enterprise App&quot; # Check the Microsoft Graph documentation for the permission you need for the operation. $PermissionName = &quot;Add your permission here&quot; # Install the module (You need admin on the machine) Install-Module AzureAD # Connect to Azure AD via tenant ID, you'll need an admin account to login with though. Connect-AzureAD -TenantId $TenantID # Collects the Target System Managed Identities information into the MSI variable. $MSI = (Get-AzureADServicePrincipal -Filter &quot;displayName eq '$DisplayNameOfMSI'&quot;) Start-Sleep -Seconds 10 # Store the Microsoft Graph API informaiton into the GraphServicePrincipal variable. $GraphServicePrincipal = Get-AzureADServicePrincipal -Filter &quot;appId eq '$GraphAppId'&quot; # Searches Microsoft Graph API for the value matching the PermissionName variable populated above and stores this in the AppRole Variable. $AppRole = $GraphServicePrincipal.AppRoles | Where-Object {$_.Value -eq $PermissionName -and $_.AllowedMemberTypes -contains &quot;Application&quot;} # Assigned the permission from the Microsoft Graph API to the target Managed Identity. New-AzureADServiceAppRoleAssignment -ObjectId $MSI.ObjectId -ResourceId $GraphServicePrincipal.ObjectId -Id $appRole.Id -PrincipalId $MSI.ObjectId  Annotated the hell out of it as the command really confused me. "},{"title":"Notes​","type":1,"pageTitle":"Assign Managed Identity permissions","url":"/Articles/PowerShell/Assign Managed Identity permissions#notes","content":"It takes a few minutes for this change to show in the GUI.If the permission already exists the promtp will error on the final command. "},{"title":"Resizing a Virtual Machine","type":0,"sectionRef":"#","url":"/Articles/Microsoft/Azure Resources Management/Resizing a Virtual Machine","content":"","keywords":"IT  KnowledgeBase  Microsoft  Azure  Computers"},{"title":"Before you begin​","type":1,"pageTitle":"Resizing a Virtual Machine","url":"/Articles/Microsoft/Azure Resources Management/Resizing a Virtual Machine#before-you-begin","content":"Shutdown the VM from within it's OS if possible (Not always necessary at all but, nice to do).If you cannot see the VM size that you're looking for it may not be compatible with your VM. You can have too many disk or NICs attached to the VM for the size you want. The typ of disks that you have attached can limit your options, premium and standard tier. "},{"title":"Re-siging the vm​","type":1,"pageTitle":"Resizing a Virtual Machine","url":"/Articles/Microsoft/Azure Resources Management/Resizing a Virtual Machine#re-siging-the-vm","content":"De-allocating a VM can cause issues! De-allocating the VM also releases any dynamic IP addresses assigned to the VM. The OS and data disks are not affected. At the same time, you're releasing your ownership of the size of that VM. If you are resizing a production VM, consider using Azure Capacity Reservations to reserve Compute capacity in the region; otherwise you may have to pick another size. Open the Azure portal, https://portal.azure.com.Search for your virtual machine.In the left menu, Select Size.Choose the new size from the list of available sizes and then Select Resize. "},{"title":"Restore from Snapshot","type":0,"sectionRef":"#","url":"/Articles/Microsoft/Azure Resources Management/Restore from Snapshot","content":"","keywords":"IT  KnowledgeBase  Microsoft  Azure  Computers"},{"title":"Create your snapshot​","type":1,"pageTitle":"Restore from Snapshot","url":"/Articles/Microsoft/Azure Resources Management/Restore from Snapshot#create-your-snapshot","content":"Validate the Snapshot Make sure to check the SnapShot is valid before starting this process. Open the Azure portal, https://portal.azure.com.Navigate to a VM that is available to have a disk attached to it.Click on Disks on the left-hand side.Create a new disk.Click Edit on the far right hand side. As shown in red above.Name your Disk, I'd suggest, snapshot_ServerName_Date_TimeSource, Select snapshot.Select the Snapshot you wish to attach.Make any changes to the Encryption Type.I'd suggest it not to be a shared disk.Press Save. This shouldn't take too long. info If you see the error below, change the Host Caching option to &quot;none&quot;.  "},{"title":"Confirm disk is visibile in the OS​","type":1,"pageTitle":"Restore from Snapshot","url":"/Articles/Microsoft/Azure Resources Management/Restore from Snapshot#confirm-disk-is-visibile-in-the-os","content":"tip The share should be available from the get go however, you may need to bring the disk online within computer management. RDP into your VM &amp; check File Explorer for your disk, the name will be what the share was called originally.Open Computer Management, Click Disk Management.Right-Click on the disk, mark it as Oneline. You should now see it in File Explorer. "},{"title":"Detach the disk​","type":1,"pageTitle":"Restore from Snapshot","url":"/Articles/Microsoft/Azure Resources Management/Restore from Snapshot#detach-the-disk","content":"Close any open sessions to the disk that you attached.Navigate back to the VM in Azure Management Portal.Click the X button to the right-hand side of the disk. "},{"title":"Managing Backup Jobs","type":0,"sectionRef":"#","url":"/Articles/Veeam/Veeam Backup for O365/Managing Backup Jobs","content":"","keywords":"IT  KnowledgeBase  Microsoft  Azure  Computers"},{"title":"Before you begin​","type":1,"pageTitle":"Managing Backup Jobs","url":"/Articles/Veeam/Veeam Backup for O365/Managing Backup Jobs#before-you-begin","content":"Veeam best practice guide link, here.Veeam User guide link, here. "},{"title":"Recommendations​","type":1,"pageTitle":"Managing Backup Jobs","url":"/Articles/Veeam/Veeam Backup for O365/Managing Backup Jobs#recommendations","content":""},{"title":"Split-up the jobs​","type":1,"pageTitle":"Managing Backup Jobs","url":"/Articles/Veeam/Veeam Backup for O365/Managing Backup Jobs#split-up-the-jobs","content":"This was a recommendation from the good folks at Veeam. Try to split the jobs based on size being backed up. An example of a suggestion below. Create a single job to capture anything that is new.If you've got loads of small SharePoint sites, split them into chunks as these will take a long time to backup. A few thousand of these will take hours to backup. For example, take the largest 10 sites and put them in their own jobs.The SharePoint backup job will also back personal sites as well, no need to include the personal sites in the other jobs. "},{"title":"Server resources & Backup App Registrations​","type":1,"pageTitle":"Managing Backup Jobs","url":"/Articles/Veeam/Veeam Backup for O365/Managing Backup Jobs#server-resources--backup-app-registrations","content":"Both resources (CPU &amp; RAM) play a major role in the performance of the proxy server. Make sure you don't go beneath 4vCPUs &amp; 16GB of RAM, below this and you'll start to see a noticable time incrase in backups.For the moment you can add more backup applications into Azure AD, that increases the amount of requests that can be made to the Office 365 resources. The more backup applications you have the quicker you'll exhaust the amount of requests that can be made per minute by the VBO solution to backup the data. "},{"title":"Microsoft Throttling​","type":1,"pageTitle":"Managing Backup Jobs","url":"/Articles/Veeam/Veeam Backup for O365/Managing Backup Jobs#microsoft-throttling","content":"After speaking with Microsoft, they no longer change the throttling limits upon request.You're limited due to the size of your organisation and amount of users, check out the link below for more information on throttling. Microsoft Link - Avoid getting throttled or blocked in SharePoint Online. "},{"title":"Object Management​","type":1,"pageTitle":"Managing Backup Jobs","url":"/Articles/Veeam/Veeam Backup for O365/Managing Backup Jobs#object-management","content":"Setup an Azure AD group to capture user objects that need to be excluded from the backups.Microsoft 365 Groups require an owner to be backed up, otherwise they'll generate warnings in your jobs. "},{"title":"Restore Errors","type":0,"sectionRef":"#","url":"/Articles/Veeam/Veeam Backup for O365/Restore Errors","content":"","keywords":"IT  KnowledgeBase  Microsoft  Azure  Computers"},{"title":"Failing to open mailbox​","type":1,"pageTitle":"Restore Errors","url":"/Articles/Veeam/Veeam Backup for O365/Restore Errors#failing-to-open-mailbox","content":""},{"title":"Scenario​","type":1,"pageTitle":"Restore Errors","url":"/Articles/Veeam/Veeam Backup for O365/Restore Errors#scenario","content":"Your Veeam Backup for Office 365 solution is pretty new and it's being tested or you've a member of your team who always gets this error for some reason. "},{"title":"The error​","type":1,"pageTitle":"Restore Errors","url":"/Articles/Veeam/Veeam Backup for O365/Restore Errors#the-error","content":"Failed to access mailbox. Mailbox does not exist. This issue mostly presents that error when you're using Modern Authentication. "},{"title":"Solution​","type":1,"pageTitle":"Restore Errors","url":"/Articles/Veeam/Veeam Backup for O365/Restore Errors#solution","content":"It turns out that in order to restore objects the user who authenticates to do the restore action must have the impersonation role, this is a custom role that you need to create via command line.  "},{"title":"External chat in Teams","type":0,"sectionRef":"#","url":"/Articles/Microsoft/Teams/External chat in Teams","content":"","keywords":"IT  KnowledgeBase  Microsoft  Azure  Computers"},{"title":"Scenario​","type":1,"pageTitle":"External chat in Teams","url":"/Articles/Microsoft/Teams/External chat in Teams#scenario","content":"You want to block external teams chat and features for internal staff to outside organisations. "},{"title":"Options for this feature​","type":1,"pageTitle":"External chat in Teams","url":"/Articles/Microsoft/Teams/External chat in Teams#options-for-this-feature","content":"Enabled for all external organisations.Disabled for all external organisations.Enabled for selected external organisations.Disabled for external organisations.Disable the feature for some users via policy. tip Options 1 to 4 above can be actioned within the Teams Admin portal, option 5 needs to be done via command line. This option is the focus of this article. "},{"title":"Setup a new policy​","type":1,"pageTitle":"External chat in Teams","url":"/Articles/Microsoft/Teams/External chat in Teams#setup-a-new-policy","content":"Install the Teams PowerShell module, here.Type the command, Connect-MicrosoftTeams to begin the sign-in process, login using the prompt that should appear.Follow the commands below to create a new Teams policy, which disables the features of external chat for end users. New-CsExternalAccessPolicy -Identity &quot;Block External Teams&quot; # Creates new policy. Set-CsExternalAccessPolicy -Identity &quot;Block External Teams&quot; -EnableTeamsConsumerAccess $False # Disables the feature for the single policy. Set-CsExternalAccessPolicy -Identity &quot;Block External Teams&quot; -EnableFederationAccess $False # Disables the feature for the single policy. Set-CsExternalAccessPolicy -Identity &quot;Block External Teams&quot; -EnableTeamsConsumerInbound $False # Disables the feature for the single policy.  "},{"title":"Enabling External Chat​","type":1,"pageTitle":"External chat in Teams","url":"/Articles/Microsoft/Teams/External chat in Teams#enabling-external-chat","content":"You want to enable the attribute EnableTeamsConsumerInbound, which is what the feature uses. You could assign the user the FederationAndPICDefault policy, I think this exists in all tenants. Grant-CsExternalAccessPolicy -Identity &quot;username&quot; -PolicyName &quot;FederationAndPICDefault&quot;  "},{"title":"See what External Access policies exist​","type":1,"pageTitle":"External chat in Teams","url":"/Articles/Microsoft/Teams/External chat in Teams#see-what-external-access-policies-exist","content":"The Command below will output a list of all External Access policies in your environment. Get-CsExternalAccessPolicy # Command to find all policies. # Example of one of the outputs from the command, yours will have more than just this one. Identity : Global Description : EnableFederationAccess : True EnableXmppAccess : False EnablePublicCloudAccess : True EnablePublicCloudAudioVideoAccess : True EnableOutsideAccess : True EnableAcsFederationAccess : True EnableTeamsConsumerAccess : True EnableTeamsConsumerInbound : True RestrictTeamsConsumerAccessToExternalUserProfiles : False  "},{"title":"Certificate Management for ADFS, WAP and Exchange","type":0,"sectionRef":"#","url":"/Articles/Windows Server/Certificate Management for ADFS, WAP and Exchange","content":"","keywords":"IT  KnowledgeBase  Microsoft  Azure  Computers"},{"title":"Generate a new CSR​","type":1,"pageTitle":"Certificate Management for ADFS, WAP and Exchange","url":"/Articles/Windows Server/Certificate Management for ADFS, WAP and Exchange#generate-a-new-csr","content":"From a server with IIS installed. Open IIS (or Internet Information Services (IIS) Manager).Select the server name from the connections list.Click on the Server Certificates option.On the right-hand side, click Create Certificate Request.Fill in the informaiton using the Wizard as accurately as possible. tip The Common Name: This should match the domain you want the Certifiacte to cover. Select 2048 for the encryption, I've never used anything less than this.Complete the wizard and save the CSR with a sensible name. Take this CSR to your chosen external certificate provider, DigiCert for example. Enter your CSR and they'll send you back a certificate file in many formats. "},{"title":"Replacement steps​","type":1,"pageTitle":"Certificate Management for ADFS, WAP and Exchange","url":"/Articles/Windows Server/Certificate Management for ADFS, WAP and Exchange#replacement-steps","content":""},{"title":"Replacing the ADFS certificate​","type":1,"pageTitle":"Certificate Management for ADFS, WAP and Exchange","url":"/Articles/Windows Server/Certificate Management for ADFS, WAP and Exchange#replacing-the-adfs-certificate","content":"Microsoft doc link.. tip The certificate thumbprint can be found by executing this command, dir Cert:\\LocalMachine\\My\\. Import the cert to the Local Machine store.Open PowerShell as an Admin.Run the command, Set-AdfsSslCertificate -Thumbprint '&lt;thumbprint of new cert&gt;'. tip The Set-AdfsSslCertificate cmdlet is a multi-node cmdlet; this means it only has to run from the primary and all nodes in the farm will be updated. This is new in Server 2016, all servers in you setup must be running 2016. "},{"title":"Replacing the SSL certificate for the Web Application Proxy​","type":1,"pageTitle":"Certificate Management for ADFS, WAP and Exchange","url":"/Articles/Windows Server/Certificate Management for ADFS, WAP and Exchange#replacing-the-ssl-certificate-for-the-web-application-proxy","content":"Microsoft doc link.. Import the cert to the Local Machine store.Open PowerShell as an Admin.Run the command, Set-WebApplicationProxySslCertificate -Thumbprint '&lt;thumbprint of new cert&gt;'. caution If the above cmdlet fails because the old certificate has already expired, reconfigure the proxy using the following cmdlets: $cred = Get-Credential Install-WebApplicationProxy -FederationServiceTrustCredential $cred -CertificateThumbprint '&lt;thumbprint of new cert&gt;' -FederationServiceName 'fs.contoso.com'  "},{"title":"Replace the certificate for Exchange 2016​","type":1,"pageTitle":"Certificate Management for ADFS, WAP and Exchange","url":"/Articles/Windows Server/Certificate Management for ADFS, WAP and Exchange#replace-the-certificate-for-exchange-2016","content":"Import the cert to the Local Machine store.Open the EAC and navigate to Servers &gt; Certificates.In the Select server list, select the Exchange server where you want to install the certificate, click More options, and select Import Exchange certificate.Follow the Wizard to import the certificate.In the Specify the servers you want to apply this certificate to page, click Add.On the Select a server page that opens, select the Exchange server where you want to install the certificate, and click Add. tip Repeat this step as many times as necessary. When you're finished selecting servers, click OK. "},{"title":"Testing​","type":1,"pageTitle":"Certificate Management for ADFS, WAP and Exchange","url":"/Articles/Windows Server/Certificate Management for ADFS, WAP and Exchange#testing","content":""},{"title":"Exchange​","type":1,"pageTitle":"Certificate Management for ADFS, WAP and Exchange","url":"/Articles/Windows Server/Certificate Management for ADFS, WAP and Exchange#exchange","content":"Open the webmail console and review the certificate presented. This should be the new certificate. "},{"title":"ADFS\\WAP​","type":1,"pageTitle":"Certificate Management for ADFS, WAP and Exchange","url":"/Articles/Windows Server/Certificate Management for ADFS, WAP and Exchange#adfswap","content":"Load the ADFS web page and review the certificate presented. This should be the new certificate. If required the customer can test by, any app\\device that requires them to sign-in to Office 365. Such as, Outlook, active-sync devices eg: ipad, mobile phones. "},{"title":"Renew Apple Tokens and Certs","type":0,"sectionRef":"#","url":"/Articles/Microsoft/Intune/Renew Apple Tokens and Certs","content":"","keywords":"IT  KnowledgeBase  Microsoft  Azure  Computers"},{"title":"Apple MDM (Mobile Device Management) certificate​","type":1,"pageTitle":"Renew Apple Tokens and Certs","url":"/Articles/Microsoft/Intune/Renew Apple Tokens and Certs#apple-mdm-mobile-device-management-certificate","content":""},{"title":"What is it?​","type":1,"pageTitle":"Renew Apple Tokens and Certs","url":"/Articles/Microsoft/Intune/Renew Apple Tokens and Certs#what-is-it","content":"The MDM push certificate is associated with the Apple ID you used to create it. The Certificate is used to enrol and manage your IOS devices in your tenant. "},{"title":"Replacement steps​","type":1,"pageTitle":"Renew Apple Tokens and Certs","url":"/Articles/Microsoft/Intune/Renew Apple Tokens and Certs#replacement-steps","content":"caution Do not let this expire, if it does expire you may have to re-enrol deviecs again. Login to https://admin.microsoft.com, navigate to the Intune portal.Go to Devices &gt; Enroll Devices &gt; Apple enrollment &gt; Apple MDM Push Certificates.Fill out the information in the window that pops out from the right. Follow the onscreen instructions. Remember to sign into the Apple Push Certificates Portal with the Apple ID you used to create your original certificate.Within the Apple Push Certificates Portal, click Renew on the old certificate. You can create a new Certificate; however, this requires further steps outlined in the following Microsoft link. Upload the new CSR you just created.After you renew and download the certificate, return to Intune to complete the remaining steps on this screen.Select Upload. "},{"title":"Enrollment program token​","type":1,"pageTitle":"Renew Apple Tokens and Certs","url":"/Articles/Microsoft/Intune/Renew Apple Tokens and Certs#enrollment-program-token","content":"Login to Office 365, navigate to the Intune portal.Go to Devices &gt; Enroll Devices &gt; Apple enrollment &gt;Enrollment program tokens.Select the token that you want to renew.Select Renew token at the top.Sign-into Apple Business Manager with the account shown on the token.Click your name in the bottom left of the screen.Under &quot;Your MDM Servers&quot; select the relevant server.Click download at the top in the right-hand half of the page. Return to Intune portal.Upload the VPP token using the provided option.Select, Next then Review + Save. "},{"title":"VPP (Volume Purchase Program) token(s)​","type":1,"pageTitle":"Renew Apple Tokens and Certs","url":"/Articles/Microsoft/Intune/Renew Apple Tokens and Certs#vpp-volume-purchase-program-tokens","content":"Login to Office 365, navigate to the Intune portal.Go to Tenant settings &gt; Connectors and tokens &gt; Apple VPP Tokens.Click on the token you want to renew.Click the Edit button next to the basics section.Sign into Apple Business Manager with the account you used to set this up originally.Click your name in the bottom left &gt; Payments and Billing.Scroll down to the Server Tokens section.Click download next to your token name, it should match the organisation in your Intune tenant.Back in Intune, upload the VPP token using the provided option.Select Save. "},{"title":"Testing​","type":1,"pageTitle":"Renew Apple Tokens and Certs","url":"/Articles/Microsoft/Intune/Renew Apple Tokens and Certs#testing","content":"Notify the customer that the above has been updated successfully. The customer should confirm they can enroll new devices into Intune, download and assign apps to the devices. "},{"title":"Removing data and licenses","type":0,"sectionRef":"#","url":"/Articles/Veeam/Veeam Backup for O365/Removing data and licenses","content":"","keywords":"IT  KnowledgeBase  Microsoft  Azure  Computers"},{"title":"References​","type":1,"pageTitle":"Removing data and licenses","url":"/Articles/Veeam/Veeam Backup for O365/Removing data and licenses#references","content":"Veeam Blog post - How to remove a license from a user in Veeam Backup for Microsoft Office 365. Veeam Rest API Reference - Revoking Licenses from users. "},{"title":"Overview​","type":1,"pageTitle":"Removing data and licenses","url":"/Articles/Veeam/Veeam Backup for O365/Removing data and licenses#overview","content":"To remove a license from a user, you first need to delete that user’s data from all configured repositories and run the remove license command with PowerShell. This can be useful if you accidently backed up a user and no longer need to keep the data. Otherwise, you must wait the 31-day threshold for the license to be reallocated. "},{"title":"Checking for stored data​","type":1,"pageTitle":"Removing data and licenses","url":"/Articles/Veeam/Veeam Backup for O365/Removing data and licenses#checking-for-stored-data","content":"Firstly, you'll need to check if there is any data stored for the user you want to remove the licnese from. Open the Veeam Backup console on your application host, select the hamburger menu in the top left, navigate to Console and click on PowerShell. # This script will show you what a data a user has on a particular repository # Fill in &quot;REPOSITORY&quot; with the name of the repository as it is showing in # Veeam Backup for Office 365 and the email address of the user you wish to remove the data for &quot;USER@DOMAIN.com&quot; $repository = Get-VBORepository -Name &quot;REPOSITORY&quot; $user = Get-VBOEntityData -Type User -Repository $repository -Name &quot;USER@DOMAIN.com&quot; $user  Provided the command above runs successfully, you'll get a table returned showing the repositories as headings, with True or False under them depending on whether the user has data in them. "},{"title":"Delete the user data from each repo​","type":1,"pageTitle":"Removing data and licenses","url":"/Articles/Veeam/Veeam Backup for O365/Removing data and licenses#delete-the-user-data-from-each-repo","content":"I won't regurgitate the perfectly good Veeam article, the link is below for all of the commands needed. How to remove a license from a user in Veeam Backup for Microsoft Office 365. Make sure to follow each section in the rough order of the article, skip over the ones where your user has no data. "},{"title":"Issues​","type":1,"pageTitle":"Removing data and licenses","url":"/Articles/Veeam/Veeam Backup for O365/Removing data and licenses#issues","content":"I ended up having to raise a support request in the end as I had some troublesome admin users who'd had their data backed up in error. I was asked by the support team member who helped me to not store the script that was used. "},{"title":"Commands returning \"Null\"​","type":1,"pageTitle":"Removing data and licenses","url":"/Articles/Veeam/Veeam Backup for O365/Removing data and licenses#commands-returning-null","content":"Some of the commands above for some reason will return a “null” error when using them, you will need to pipe the command into a search to find the relevant data. Get-VBOLicensedUser -Organization $org | ?{$_.username -like &quot;*-adm*&quot;} # You can then loop through an array if you store the above command into a variable. Get-VBOLicensedUser -Organization $org |?{$_.username -like &quot;*-adm*&quot;}|foreach-object {remove-vbolicenseduser $_}  "},{"title":"Welcome to the Wiki","type":0,"sectionRef":"#","url":"/Welcome","content":"","keywords":"IT  KnowledgeBase  Microsoft  Azure  Computers"},{"title":"How the site works​","type":1,"pageTitle":"Welcome to the Wiki","url":"/Welcome#how-the-site-works","content":"The website is stored within a GitHub Repo, this is then copied over to a Static Web App hosted in Azure using a GitHub action.The site is generated using Docusaurus, big shout to them for making this incredible beast! "},{"title":"Navigating the Wiki​","type":1,"pageTitle":"Welcome to the Wiki","url":"/Welcome#navigating-the-wiki","content":"Naviagte using the navbar on the left hand side.There is a search bar in the top right, try searching keywords for what you're after. "},{"title":"Guides​","type":1,"pageTitle":"Welcome to the Wiki","url":"/Welcome#guides","content":"Are deep dives into setting up certain technologies or solutions. "},{"title":"Articles​","type":1,"pageTitle":"Welcome to the Wiki","url":"/Welcome#articles","content":"Are help docs or small snippets of information.I'd recommend using the search bar in the top right to search for related information. "},{"title":"Tooling​","type":1,"pageTitle":"Welcome to the Wiki","url":"/Welcome#tooling","content":"Are notes on tools that I use day to day in my job and at home that I think are cool. "},{"title":"Contact Me​","type":1,"pageTitle":"Welcome to the Wiki","url":"/Welcome#contact-me","content":"You can reach me at the below email address should you want to. WillH@theitkb.co.uk "},{"title":"Export AAD Secrets and Certs","type":0,"sectionRef":"#","url":"/Articles/PowerShell/Export AAD Secrets and Certs","content":"Export AAD Secrets and Certs The script below was created originally by Microsoft, I will find the link where this came from. ################################################################################# #DISCLAIMER: This is not an official PowerShell Script. We designed it specifically for the situation you have encountered right now. #Please do not modify or change any preset parameters. #Please note that we will not be able to support the script if it is changed or altered in any way or used in a different situation for other means. #This code-sample is provided &quot;AS IT IS&quot; without warranty of any kind, either expressed or implied, including but not limited to the implied warranties of merchantability and/or fitness for a particular purpose. #This sample is not supported under any Microsoft standard support program or service.. #Microsoft further disclaims all implied warranties including, without limitation, any implied warranties of merchantability or of fitness for a particular purpose. #The entire risk arising out of the use or performance of the sample and documentation remains with you. #In no event shall Microsoft, its authors, or anyone else involved in the creation, production, or delivery of the script be liable for any damages whatsoever (including, without limitation, damages for loss of business profits, business interruption, loss of business information, or other pecuniary loss) arising out of the use of or inability to use the sample or documentation, even if Microsoft has been advised of the possibility of such damages. ################################################################################# Connect-AzureAD $Applications = Get-AzureADApplication -all $true $Logs = @() foreach ($app in $Applications) { $AppName = $app.DisplayName $AppID = $app.objectid $ApplID = $app.AppId $AppCreds = Get-AzureADApplication -ObjectId $AppID | Select-Object PasswordCredentials, KeyCredentials $secret = $AppCreds.PasswordCredentials $cert = $AppCreds.KeyCredentials ############################################ $Log = New-Object System.Object $Log | Add-Member -MemberType NoteProperty -Name &quot;ApplicationName&quot; -Value $AppName $Log | Add-Member -MemberType NoteProperty -Name &quot;ApplicationID&quot; -Value $ApplID $Log | Add-Member -MemberType NoteProperty -Name &quot;Secret Start Date&quot; -Value $Null $Log | Add-Member -MemberType NoteProperty -Name &quot;Secret End Date&quot; -value $Null $Log | Add-Member -MemberType NoteProperty -Name &quot;Certificate Start Date&quot; -Value $Null $Log | Add-Member -MemberType NoteProperty -Name &quot;Certificate End Date&quot; -value $Null $Log | Add-Member -MemberType NoteProperty -Name &quot;Owner&quot; -Value $Null $Log | Add-Member -MemberType NoteProperty -Name &quot;Owner_ObjectID&quot; -value $Null $Logs += $Log ############################################ foreach ($s in $secret) { $StartDate = $s.StartDate $EndDate = $s.EndDate #$operation = $EndDate - $now #$ODays = $operation.Days $Owner = Get-AzureADApplicationOwner -ObjectId $app.ObjectId $Username = $Owner.UserPrincipalName -join &quot;;&quot; $OwnerID = $Owner.ObjectID -join &quot;;&quot; if ($owner.UserPrincipalName -eq $Null) { $Username = $Owner.DisplayName + &quot; **&lt;This is an Application&gt;**&quot; } if ($Owner.DisplayName -eq $null) { $Username = &quot;&lt;&lt;No Owner&gt;&gt;&quot; } $Log = New-Object System.Object $Log | Add-Member -MemberType NoteProperty -Name &quot;ApplicationName&quot; -Value $AppName $Log | Add-Member -MemberType NoteProperty -Name &quot;ApplicationID&quot; -Value $ApplID $Log | Add-Member -MemberType NoteProperty -Name &quot;Secret Start Date&quot; -Value $StartDate $Log | Add-Member -MemberType NoteProperty -Name &quot;Secret End Date&quot; -value $EndDate $Log | Add-Member -MemberType NoteProperty -Name &quot;Certificate Start Date&quot; -Value $Null $Log | Add-Member -MemberType NoteProperty -Name &quot;Certificate End Date&quot; -value $Null $Log | Add-Member -MemberType NoteProperty -Name &quot;Owner&quot; -Value $Username $Log | Add-Member -MemberType NoteProperty -Name &quot;Owner_ObjectID&quot; -value $OwnerID $Logs += $Log } foreach ($c in $cert) { $CStartDate = $c.StartDate $CEndDate = $c.EndDate #$COperation = $CEndDate - $now #$CODays = $COperation.Days $Owner = Get-AzureADApplicationOwner -ObjectId $app.ObjectId $Username = $Owner.UserPrincipalName -join &quot;;&quot; $OwnerID = $Owner.ObjectID -join &quot;;&quot; if ($owner.UserPrincipalName -eq $Null) { $Username = $Owner.DisplayName + &quot; **&lt;This is an Application&gt;**&quot; } if ($Owner.DisplayName -eq $null) { $Username = &quot;&lt;&lt;No Owner&gt;&gt;&quot; } $Log = New-Object System.Object $Log | Add-Member -MemberType NoteProperty -Name &quot;ApplicationName&quot; -Value $AppName $Log | Add-Member -MemberType NoteProperty -Name &quot;ApplicationID&quot; -Value $ApplID $Log | Add-Member -MemberType NoteProperty -Name &quot;Certificate Start Date&quot; -Value $CStartDate $Log | Add-Member -MemberType NoteProperty -Name &quot;Certificate End Date&quot; -value $CEndDate $Log | Add-Member -MemberType NoteProperty -Name &quot;Owner&quot; -Value $Username $Log | Add-Member -MemberType NoteProperty -Name &quot;Owner_ObjectID&quot; -value $OwnerID $Logs += $Log } } Write-host &quot;Add the Path you'd like us to export the CSV file to, in the format of &lt;C:\\Users\\&lt;USER&gt;\\Desktop\\Users.csv&gt;&quot; -ForegroundColor Green $Path = Read-Host $Logs | Export-CSV $Path -NoTypeInformation -Encoding UTF8 ","keywords":"IT  KnowledgeBase  Microsoft  Azure  Computers"},{"title":"Setup Azure Backup","type":0,"sectionRef":"#","url":"/Guides/Setup Azure Backup","content":"","keywords":"IT  KnowledgeBase  Microsoft  Azure  Computers"},{"title":"Create the below resources in the FW-Azure Production subscription​","type":1,"pageTitle":"Setup Azure Backup","url":"/Guides/Setup Azure Backup#create-the-below-resources-in-the-fw-azure-production-subscription","content":"info Use whatever naming conention fits in with what's being used already, I am just suggesting something here. Create the resource group, for example, rg-&lt;customername&gt;-&lt;region&gt;-&lt;prod/dev&gt;-backups-01.Create a recovery services vault to store the backups (GRS is the preferred option, LRS for lowest cost), for example, rsv-&lt;customername&gt;-&lt;region&gt;-&lt;prod/dev&gt;-backup-01.Create a log analytics workspace or reuse another one, for example, la-&lt;customername&gt;-&lt;region&gt;-&lt;prod/dev&gt;-backup-01. "},{"title":"Configure Backup Policy​","type":1,"pageTitle":"Setup Azure Backup","url":"/Guides/Setup Azure Backup#configure-backup-policy","content":"Configure the backup policy in-line with whatever standard is being used already, my suggestions are below. In the Azure portal, select a Recovery Services vault to back up the VM.Under Backup, select Backup Policies.Click +Add.On Select policy type, select Azure Virtual Machine.On Create policy, perform the following actions: Policy sub type: StandardSuggested Name format: Bkup-policy-&lt;time of day&gt;-&lt;policy type&gt; (example name: bkup-policy-nightly-std).  "},{"title":"Configure Alerting​","type":1,"pageTitle":"Setup Azure Backup","url":"/Guides/Setup Azure Backup#configure-alerting","content":"tip Note that this method is using the old backup alerting method, this is being replaced by Azure Monitor. Microsoft Link for more information Configure diagnostic logs to be sent from Azure Backup to the Log Anlytics workspace above. From the Recovery services vault just setup. Click on Backup Alerts, under the Monitoring section.Click Configure Notifications. Enable Notifications: YesRecipients(Email): monitoring@DomainName.comNotify: Hourly digestSeverity: Critical &amp; Warning Example of this below. "},{"title":"Configure Diagnostic log collection​","type":1,"pageTitle":"Setup Azure Backup","url":"/Guides/Setup Azure Backup#configure-diagnostic-log-collection","content":"Configure diagnostic logs to be sent from Azure Backup to the Log Anlytics workspace above. Navigate to Diagnostic settings under Monitoring.Click Add Diagnostic Settings.Name your diagnostic setting, something informational, for example, &quot;AzBkup-Diagnostics&quot;, suggestion, Backup Report Data.Select Send to Log Analytics Workspace.Add a workspace and don't touch any other settings.Hit Save. tip Make sure to run the initial backup job from the Azure Backup Dashboard. "},{"title":"Devolutions Remote Desktop Manager","type":0,"sectionRef":"#","url":"/Tooling/Devolutions RDM","content":"","keywords":"IT  KnowledgeBase  Microsoft  Azure  Computers"},{"title":"Noteable abilities (free version)​","type":1,"pageTitle":"Devolutions Remote Desktop Manager","url":"/Tooling/Devolutions RDM#noteable-abilities-free-version","content":"RDP connection management.Password Management.Cross-platform. The paid for version supports installing a central database on a local server to be shared by endusers, with role based access and reporting. "},{"title":"Setup​","type":1,"pageTitle":"Devolutions Remote Desktop Manager","url":"/Tooling/Devolutions RDM#setup","content":"Download the app from the website.Install it, upon first run you'll need to setup an account.To add your first RDP connection, right-click on the top of the navigation bar on the left-left hand side.Click new entry. You're off and ready to go. "},{"title":"Prettier Terminal Window","type":0,"sectionRef":"#","url":"/Tooling/Prettier Terminal Window","content":"","keywords":"IT  KnowledgeBase  Microsoft  Azure  Computers"},{"title":"Install the Windows Terminal App​","type":1,"pageTitle":"Prettier Terminal Window","url":"/Tooling/Prettier Terminal Window#install-the-windows-terminal-app","content":"Download it free from the Microsoft store, once installed run the terminal application. If you're doing this on a domain joined machine, you'll need to run the terminal application on both the user account and the administrator account to create the profiles. "},{"title":"Install OH-MY-POSH​","type":1,"pageTitle":"Prettier Terminal Window","url":"/Tooling/Prettier Terminal Window#install-oh-my-posh","content":"Follow these instructions for Windows machines, this is the official website. I recommend using winget via PowerShell to get the stuff. winget install JanDeDobbeleer.OhMyPosh -s winget  "},{"title":"Download fonts from Nerd Fonts​","type":1,"pageTitle":"Prettier Terminal Window","url":"/Tooling/Prettier Terminal Window#download-fonts-from-nerd-fonts","content":"These are some instructions from the Oh My Posh site to do this. In your terminal prompt, type oh-my-posh font install, this should then install the on my posh font. Next you need to configure the Terminal app to use the new font. You can edit the JSON file or you can do it in the GUI by clicking on the down arrow next to your open tab in Terminal. Click Settings, then click Defaults and click Appearance. Click on the font list next to the option, Font Face, select the Oh my posh font. "},{"title":"Edit the PowerShell profile​","type":1,"pageTitle":"Prettier Terminal Window","url":"/Tooling/Prettier Terminal Window#edit-the-powershell-profile","content":"Check out this link for the source matierial for the below Edit your PowerShell profile script, you can find its location under the $PROFILE variable in your preferred PowerShell version. For example, using notepad, notepad $PROFILE. If the command errors, you will need to create the profiel first, New-Item -Path $PROFILE -Type File -Force. Inside your profile, add the following line into it. oh-my-posh init pwsh --config 'C:/Users/Posh/jandedobbeleer.omp.json' | Invoke-Expression  If you want to change the theme, navigate to the theme folder, if you don't know where that is, enter the following command (Get-Command oh-my-posh).Source. "},{"title":"Other suggestions​","type":1,"pageTitle":"Prettier Terminal Window","url":"/Tooling/Prettier Terminal Window#other-suggestions","content":""},{"title":"Install PSReadLine​","type":1,"pageTitle":"Prettier Terminal Window","url":"/Tooling/Prettier Terminal Window#install-psreadline","content":"This module shows autocomplete suggestions based on the recent commands you've run, it's a great addition. Reference blog post from the Microsoft DevBlogs. Install the module, Install-Module PSReadLine. You need version 2.1.0 or higher for this to work properly. Enable Predictive IntelliSense by running this command, Set-PSReadLineOption -PredictionSource History, you should then start to see grey text in your PowerShell prompt that's running currently. The default key binding to use the prediction is right-arrow. You can change the color for those predictions by using the following commands. Set-PSReadLineOption -Colors @{ InlinePrediction = '#8A0303'} # This is dark red. Set-PSReadLineOption -Colors @{ InlinePrediction = '#2F7004'} # This is a dark green. # This will set it back to default. Set-PSReadLineOption -Colors @{ InlinePrediction = &quot;$([char]0x1b)[36;7;238m&quot;}  Make sure to update your PowerShell profile to load this module. Type notepad $profile into your terminal window, this should load your profile into notepad. Paste in the following lines. Set-PSReadLineOption -PredictionSource History Set-PSReadLineOption -PredictionViewStyle ListView  "},{"title":"Create an Automation Account","type":0,"sectionRef":"#","url":"/Guides/Create an Automation Account","content":"","keywords":"IT  KnowledgeBase  Microsoft  Azure  Computers"},{"title":"Outline​","type":1,"pageTitle":"Create an Automation Account","url":"/Guides/Create an Automation Account#outline","content":"Setup the Resource Group and Automation Account.Setup the Identity for the Automation Account, this is key to running scripts gainst Azure Active Directoy and Office 365 resources. Create ourselves a Runbook, that sits inside the Automation Account. Install the relevant modules for the code we want to run.Write ourselves a little script. Setup a schedule for the Runbook. "},{"title":"Setup the Resource Group and Automation Account.​","type":1,"pageTitle":"Create an Automation Account","url":"/Guides/Create an Automation Account#setup-the-resource-group-and-automation-account","content":"Navigate to the Azure portal.Search for Automation Account in the search bar.Select the Automation Account option, Click create in the middle of the screen or Click +Add in the top left.Fill in the necessary information. Resource Group Name (Create one if needs be).Name.Region caution Make sure you Select the same region as the resources you want to query, if the account is to query something else, like Azure AD or Office 365, the region is not so important. Select the Advanced tab and Select the best option for you. System assigned, is attached to the automation account it lives and dies with the automation account resource.User assigned, is one you setup yourself in Azure AD and can be used by multiple resources and is completely seperate to your automation account. Click Review + Create to setup the resource. tip You'll need to assign Azure ADroles and App Permissions to the System or User managed Identity, Microsoft have decided not to make this easy and it needs to be done via command line. "},{"title":"Setup Automation Runbook​","type":1,"pageTitle":"Create an Automation Account","url":"/Guides/Create an Automation Account#setup-automation-runbook","content":"Sign in to the Azure portal.Search for and Select Automation Accounts.On the Automation Accounts page, Select your Automation account from the list.From the Automation account, Select Runbooks under Process Automation to open the list of runbooks.Click Create a runbook and fill in the information below. Name .Select its type.Select the Runtime versionEnter applicable Description Click Create to create the runbook. "},{"title":"Install any Modules​","type":1,"pageTitle":"Create an Automation Account","url":"/Guides/Create an Automation Account#install-any-modules","content":"Sign in to the Azure portal.Search for and Select Automation Accounts.On the Automation Accounts page, Select your Automation account from the list.From the Automation account, Select Modules under Shared Resources. In here you can see a list of currently installed modules and you can add more by Clicking on the +Add a module button. tip You may find that you have to search around a bit for the module that you do actually want and when you do find the module you want, search for the command that you want to use, sometimes the module name is right but the command is missing! Microsoft Graph is probably the most well rounded module but, it's quite finicky to use, otherwise stick with the Az Command line. "},{"title":"Test Script​","type":1,"pageTitle":"Create an Automation Account","url":"/Guides/Create an Automation Account#test-script","content":""},{"title":"Create the Script​","type":1,"pageTitle":"Create an Automation Account","url":"/Guides/Create an Automation Account#create-the-script","content":"Navigate to your runbook.Click Edit at the top.Here you can enter your script. Useful options on the left hand side to note: CMDLETS, which you can use to find commands from the installed modules.ASSETS, which will show you the various resources available to your runbooks which are saved within your automation account resource. "},{"title":"Test Script​","type":1,"pageTitle":"Create an Automation Account","url":"/Guides/Create an Automation Account#test-script-1","content":"Once your done and ready to test. Click on Test pane at the top.Click Start in the top left to being running the scrpt. I found it really hard to get my head around how this works for some reason. So expect that this may take quite a few tries to get right. Storage Account Key Before you can use the script as a base, you'll need to store the storage account key as a variable in your Automation account. Open your Automation Account.Click on Variables under Shared Resources.Click Add a variable.Create a new string variable. See the script for how to reference these in your runbooks. # Ensures you do not inherit an AzContext in your runbook Disable-AzContextAutosave -Scope Process | Out-Null #Storage Account Information $StorageACCKey = Get-AutomationVariable -Name 'stgacckey01' $ContainerName = &quot;Enter the blob container name&quot; # Connect using a Managed Service Identity try { Connect-AzAccount -Identity } catch{ Write-Output &quot;Unable to login. Aborting.&quot;; exit } $Users = Get-AzADUser | Select-Object DisplayName, Id, Mail, UserPrincipalName Write-Output $Users # Exports the data in the $Users variable into a local environmental variable that will store the information whilst running in the Automation account. $Users | Export-Csv &quot;$Env:temp\\Users.csv&quot; -notypeinformation # Creates a new context to enable connection to the storage account. $Context = New-AzureStorageContext -StorageAccountName &quot;whautomationfiledump&quot; -StorageAccountKey $StorageACCKey # This copes the csv file in the $Env:temp/MFAState.csv variable and copies it to the blob. Set-AzureStorageBlobContent -Context $Context -Container $ContainerName -File &quot;$Env:temp\\Users.csv&quot; -Blob &quot;Users.csv&quot; -force  In my experience The test window is not like a command promtp and will not output the commands running or anything at all apart from really confusing errors. Try to build error catching into your script, use the try, catch commands to write the errors to the promtp for debugging. More in this in the testing section at the bottom. "},{"title":"Setup the Schedule​","type":1,"pageTitle":"Create an Automation Account","url":"/Guides/Create an Automation Account#setup-the-schedule","content":"This has been mostly regurgitated from this Microsoft link here. From your Automation account, on the left-hand pane Select Schedules under Shared Resources.Select Add a schedule.Select whether the schedule runs once or on a reoccurring schedule by Selecting Once or Recurring. If you Select Once, specify a start time and then Select Create.If you Select Recurring, specify a start time. For Recur every, Select how often you want the runbook to repeat. Select by hour, day, week, or month. Press Create to complete. tip You must publish the runbook before you can assign the schedule to it. Head back to your Runbook.Select Link to schedule at the top.Click the option to Link a schedule to your runbook, Select the schedule you created from the list.Click OK to complete. Example schedule below  "},{"title":"Testing​","type":1,"pageTitle":"Create an Automation Account","url":"/Guides/Create an Automation Account#testing","content":""},{"title":"Testing the script​","type":1,"pageTitle":"Create an Automation Account","url":"/Guides/Create an Automation Account#testing-the-script","content":"Error handling​ The test pane window for the most part will not output useful errors or show you how the script is running. I'd suggest building error handling and status updates into your script if you wish during debugging, it will help immensely. An example of the try, catch command sytax is below. # Connect using a Managed Service Identity try { Connect-AzAccount -Identity } catch{ Write-Output &quot;Unable to login. Aborting.&quot;; exit }  I'd also suggest using write-output all over the place to confirm progress and variables etc. Shout out to the VS code module for Automation Accounts, it'll let you pull down the runbook contents and edit in VsCode and upload it again. "},{"title":"Confirm the data export​","type":1,"pageTitle":"Create an Automation Account","url":"/Guides/Create an Automation Account#confirm-the-data-export","content":"Navigate to your storage account.Click on the File shares or Containers option, wherever you saved your data to.Click into the share\\container, find your file and Click on the 3 dots to the right of it. Click View\\edit, it should display a basic output of the file. "},{"title":"Further notes​","type":1,"pageTitle":"Create an Automation Account","url":"/Guides/Create an Automation Account#further-notes","content":"Run As accounts are being deprecated, this method is by far the easiest to use when trying to pull info from AzureAD and Office 365. "},{"title":"Azure Lighthouse Setup","type":0,"sectionRef":"#","url":"/Guides/Azure Lighthouse Setup","content":"","keywords":"IT  KnowledgeBase  Microsoft  Azure  Computers"},{"title":"Prerequisites and Notes​","type":1,"pageTitle":"Azure Lighthouse Setup","url":"/Guides/Azure Lighthouse Setup#prerequisites-and-notes","content":""},{"title":"Online Reading​","type":1,"pageTitle":"Azure Lighthouse Setup","url":"/Guides/Azure Lighthouse Setup#online-reading","content":"Microsoft doc - What is Azure Lighthouse?.Microsoft doc - Onboard a customer to Azure Lighthouse. "},{"title":"Training​","type":1,"pageTitle":"Azure Lighthouse Setup","url":"/Guides/Azure Lighthouse Setup#training","content":"From testing I found that many staff Ire over-whelmed or confused initially by the customer resources showing in their own managing tenant, consider setting up Lighthouse for your more technical staff first who can train the others.Consider keeping the permissions as simple as possible and only giving access to Lighthouse those who really need it. Subscription Filter. When you add a new custoemr via Lighthouse, you'll need to amend the filter to show them. I'd highly recommend training staff to use the filter to work with one subscription or customer at a time, save making changes to the wrong client\\customer. "},{"title":"Permissions and Roles​","type":1,"pageTitle":"Azure Lighthouse Setup","url":"/Guides/Azure Lighthouse Setup#permissions-and-roles","content":"Azure Roles. There are over 170 roles in Azure, that's a silly amount of trawl through to find the perfect combination to work with. Consider what you look after for your client\\customer and simplify it as much as possible, limiting access to the staff who really need it maybe enough of a security control for you. If you're an MSP there are too many roles to consider, I'd suggest using at the minimum or two groups that assign the Contributor role and the Reader role seperately. You can use this segregation to seperate those who should look but not touch and those who need to administer and manage.PIM elevation works Ill to provide just-in-time access or to require approvers for work that the elevated rights is needed for.The Managed Services Registration assignment Delete Role, should be assigned so the managing tenant can remove their own Lighthouse delegation without asking the customer to do it.Contributor is the highest role you can assign through Lighthouse. "},{"title":"Azure Lighthouse Deployment​","type":1,"pageTitle":"Azure Lighthouse Setup","url":"/Guides/Azure Lighthouse Setup#azure-lighthouse-deployment","content":"You need separate deployments for each subscription being onboarded, even if you are onboarding subscriptions in the same customer tenant. The same is true for multiple different resourece groups within a single customer.To have a valid ARM template\\offering you must have one permanently assigned role, such as Reader.Contributor is the highest role you can assign through Lighthouse. (Duplicated I know but, this is important!) "},{"title":"Setup Guidance and Information​","type":1,"pageTitle":"Azure Lighthouse Setup","url":"/Guides/Azure Lighthouse Setup#setup-guidance-and-information","content":""},{"title":"Azure AD​","type":1,"pageTitle":"Azure Lighthouse Setup","url":"/Guides/Azure Lighthouse Setup#azure-ad","content":"Create your groups in Azure AD, these groups will contain the staff members that will need access to the customer\\client via Azure Lighthouse. I'd Suggest something like the below, the groups can be as granular as you like and as numerious as you like. Azure Lighthouse Contributor.Azure Lighthouse Reader. Role Assignment to staff business roles. I tried initially to setup groups for our finance team, so they'd be able to manage billing hoIver, this didn't seem to work as I expected. The Billing role didn't seem to grant the access I thought it would, probably me not know how to use permissions properly but, consider that it might take a few goes to get it right. I eventually decided they should be using Partner Centre to query billing issues. "},{"title":"Azure Lighthouse Offering​","type":1,"pageTitle":"Azure Lighthouse Setup","url":"/Guides/Azure Lighthouse Setup#azure-lighthouse-offering","content":"ARM Template​ Below is an outline and suggestion for each relevant configuratble options for the ARM template. On-boarding multiple Subscriptions or Resource Groups for one client\\customer. You need separate deployments for each subscription being onboarded, even if you are onboarding subscriptions in the same customer tenant. The same is true for multiple different resourece groups within a single customer. Offering Name​ This will show in your customer tenant so make sure if reads &quot;nicely&quot;, I'd suggest something like the following. Managing Company Name Lighthouse Contributor Offer for Customer Name - Subscrption or Resource Group Name.Managing Company Name Lighthouse Reader Offer for Customer Name - Subscrption or Resource Group Name. Swap out the relevant information above if you use this naming convention. Description(s)​ This is also customer facing, my suggestion is below. Managing Company Name managed services offer to administer support resources.Managing Company Name offer to work on and administer project resources for project or PO number. Delegation Scope(s)​ You've got two options, Subscription and Resource Group, fairly self explenatory however, you cannot change these after deployment so make sure you select the right one for your needs. Authorizations​ Principal type: GroupName: Select one of the noted groups in section above.Display Name: Do not edit. (Friendly name that shows in customer tenant, will default to the group name) Role: Assign the roles noted against the groups above.Access Type: Permanent. "},{"title":"ARM template Example​","type":1,"pageTitle":"Azure Lighthouse Setup","url":"/Guides/Azure Lighthouse Setup#arm-template-example","content":"You can ignore the top few lines until you find mspOfferName, close to this you'll find your description field. Change the defaultValue: information, not the desciption: information. Confirming your scope. &quot;$schema&quot;: &quot;https://schema.management.azure.com/schemas/2019-08-01/subscriptionDeploymentTemplate.json#&quot;,, this line should say subscription or resource deployment template, depending on what you selected. Similar situation with the mspOfferDescription: as well.  &quot;mspOfferName&quot;: { &quot;type&quot;: &quot;string&quot;, &quot;metadata&quot;: { &quot;description&quot;: &quot;Specify a unique name for your offer&quot; }, &quot;defaultValue&quot;: &quot;My Company Lighthouse Contributor Offer for Customer Name - Subscription Name &quot; }, &quot;mspOfferDescription&quot;: { &quot;type&quot;: &quot;string&quot;, &quot;metadata&quot;: { &quot;description&quot;: &quot;Name of the Managed Service Provider offering&quot; }, &quot;defaultValue&quot;: &quot;My Company managed services offer to administer support resources.&quot; }  Locate the variables: section to define your group and the Azure role assignments. managedByTenantId&quot; - is your tenant or partner tenant ID.&quot;authorizations&quot;: - Are you Azure Roles assignments.&quot;principalId&quot; - Is your object in the managing tenant.&quot;roleDefinitionId&quot; - Is the Azure AD role you've assigned. In the case below, it's Contributor and the Managed Services Registration assignment Delete roles.&quot;principalIdDisplayName&quot; - Is your friendly Group name, this will show in your customer tenant, it does not need to match the group name in the managing tenant. You'll see some of the information repeated for each role you assign to the same object in the manging tenant. &quot;variables&quot;: { &quot;mspRegistrationName&quot;: &quot;[guid(parameters('mspOfferName'))]&quot;, &quot;mspAssignmentName&quot;: &quot;[guid(parameters('mspOfferName'))]&quot;, &quot;managedByTenantId&quot;: &quot;Your tenant ID&quot;, &quot;authorizations&quot;: [ { &quot;principalId&quot;: &quot;Your object in the managing tenant&quot;, &quot;roleDefinitionId&quot;: &quot;b24988ac-6180-42a0-ab88-20f7382dd24c&quot;, &quot;principalIdDisplayName&quot;: &quot;Lighthouse Contributor&quot; }, { &quot;principalId&quot;: &quot;Your object in the managing tenant&quot;, &quot;roleDefinitionId&quot;: &quot;91c1777a-f3dc-4fae-b103-61d183457e46&quot;, &quot;principalIdDisplayName&quot;: &quot;Lighthouse Contributor&quot; } ] },  You can edit the JSON template directly! You don't need to always duck back into Azure Lighthouse to create the templates, you can just edit the JSON files if you're comfortable doing so. "},{"title":"Implementation steps​","type":1,"pageTitle":"Azure Lighthouse Setup","url":"/Guides/Azure Lighthouse Setup#implementation-steps","content":"Below are the cut down version steps for deploying the product at at high level. Requisites - Customer tenant IDs. - Requred for command line and Azure Marketplace deployments. - Applicable customer Subscription(s) IDs. - Requred for command line and Azure Marketplace deployments. - Setup 2 Groups (within Azure AD), with the roles noted: - - Lighthouse Contributor: Contributor, Managed Services Registration assignment Delete Role. - Lighthouse Reader: Reader. Steps to create the Azure Lighthouse Delegation offering: 1. Navigate to the Azure Lighthouse Blade in managing Azure tenant. 2. Create a new Arm template, name it appropriately. 3. Assign the groups created above to the Azure roles available in the Wizard. 4. Complete the Wizard and download the ARM template. Setting up the delegation in the Customer Tenant: 1. Login to customer Azure Tenant. 2. Search Azure for the Service Providers Blade. 3. Click Add offer, Select Add via template. 4. Upload the ARM template. 5. Select the plus symbol next to the new entry in the list. 6. Click Delegate subscriptions. 7. Select the subscriptions from the list. 8. Check the confirmation box at the bottom and click Delegate. Repeat this for each customer. Backout Plan Remove the delegation. From the partner tenant (requires the `Managed Services Registration assignment Delete Role`. ) 1. Navigate to the My customers page. 2. Select Delegations. 3. Find the delegation you want to remove, then select the trash can icon that appears in its row. Failing this method, login to the customer tenant with Global Admin Priviliges and remove the delegation from the Service Providers blade.  "},{"title":"Using Lighthouse​","type":1,"pageTitle":"Azure Lighthouse Setup","url":"/Guides/Azure Lighthouse Setup#using-lighthouse","content":"tip The methods below are 2 direct methods for accessing customers, you'll be able to see their resources in the portal as if they were your own without having to use the two methods below. "},{"title":"Via the Lighthouse blade​","type":1,"pageTitle":"Azure Lighthouse Setup","url":"/Guides/Azure Lighthouse Setup#via-the-lighthouse-blade","content":"Open the Azure Management Portal.Search for Azure Lighthouse.Click on the Delegations option on the left-hand side, you may need to click manage my customers if you’ve no connections.You will then see your list of your customer’s subscriptions that you have access to. "},{"title":"Via the subscriptions blade​","type":1,"pageTitle":"Azure Lighthouse Setup","url":"/Guides/Azure Lighthouse Setup#via-the-subscriptions-blade","content":"You'll need to show the customer in the subscription fitler first though. Open the Azure Management Portal.Navigate to the Subscriptions blade.The list of subscriptions will also list the customer subscriptions you have access too. You won't see the the customer subscriptions straight away! You need to first enable this in the Subscription filter. In the Azure portal, Select the Directory + subscriptions or Settings icon in the top right of the page.In the Directories + subscriptions settings page, ensure that the Advanced filters toggle is turned off.In the Default subscription filter section, select the appropriate directory and subscription. (If you have been granted access to one or more resource groups, rather than to an entire subscription, select the subscription to which that resource group belongs. You'll then work in the context of that subscription, but will only be able to access the designated resource group(s). "},{"title":"Partner Earned Credit (PEC) using PAL​","type":1,"pageTitle":"Azure Lighthouse Setup","url":"/Guides/Azure Lighthouse Setup#partner-earned-credit-pec-using-pal","content":"PAL - Partner Admin link PAL is how a partner can be recognised by Microsoft for their work in Azure on-behalf-of their customer. Microsoft doc - Associate your partner ID when you onboard new customers vai Lighthouse.Microsoft doc - Link a PartnerID with PAL or DPOR for PAL To do this via Lighthouse, in a nutshell. Create a service principal user account in your managing tenant.Using that service principal account, link to your Associated Partner ID in your managing tenant.Include at least one authorization which includes the service principal Account as a user with an Azure built-in role that is eligible for PEC.  caution This role must be granted as a permanent assignment, not as a just-in-time eligible authorization, in order for PEC to apply. "}]