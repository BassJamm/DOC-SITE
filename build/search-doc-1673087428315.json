[{"title":"My Automation Nightmare","type":0,"sectionRef":"#","url":"/blog/My-Automation-Nightmare","content":"How the hell do I automate a script in Azure?!? Buckle up, this is probably going to be a long one, hopefully, by the end of it, you'll have a good idea of where to start with the problem of automating script in Azure. You got a few options here for automating scripts in Azure, check out this post for the other options available to you here,you've got Azure Functions, Logic Apps and Automation accounts. In this case, the scenario is PowerShell scripts and the tool I'm going to setup is an Automation account. Document incoming Check out the full tech doc for the Automation Account and my script example in the Docs area of the site. Annoyingly I cannot link it directly becuase of the way Docusarus works (not digging on you but, that is frustrating!). Update: The document is still in the works, collecting all my info! I'll do more on the other options in later posts. Setup the Resource Group and Automation Account.Setup the Identity for the Automation Account, this is key to running scripts against Azure Active Directoy and Office 365 resources.Create ourselves a Runbook, that sits inside the Automation Account.Install the relevant modules for the code we want to run.Write ourselves a little script.Setup a schedule for the Runbook. Estimated time to completion: 1 hour (probably more than that if you're creating the script for the first time!) Now, that sounds pretty simple when it's written in a small list like the one above eh? I can tell you now that I ran into random issues all over the place and, that 1 hour estimate went straight out the window! Step 1 flew by, steps 2, 3 and 4 went by like a flash, I was 15 minutes in and feeling pretty confident with how it was going so far. Considering I'd suggested doing this process at my day job to demonstrate how easy it can be to set up and the time-saving benefits we could reap once it's set up. Well, I was in for a surprise......... For step 2 in the list, Setup the Identity for the Automation Account, I chose to use a System-assigned Managed Identity, it sounded right up my street for what I needed to do. The service principal is tied to the lifecycle of that Azure resource. When the Azure resource is deleted, Azure automatically deletes the service principal for you. By design, only that Azure resource can use this identity to request tokens from Azure AD. You authorize the managed identity to have access to one or more services. Quoted from Microsotft Doc. Maybe I am just a bit of an idiot on this one because looking back on this, that doesn't sound quite right, although the user assigned managed identity also didn't sound much different to me either...... Before I knew it, I'm at the point of testing my script, I've followed through the Microsoft docs for how to leverage the System-assigned Managed Identity to connect to Exchange Online and feeling fairly confident althoug skeptical as to how minmal that command actually is. $tenantDomain = &quot;mydomain.onmicrosoft.com&quot; # Domain of the tenant the managed identity belongs to Connect-ExchangeOnline -ManagedIdentity -Organization $tenantDomain Lo and behold, that failed. What followed was a 3 hour battle with this thing before I realised that the System-assigned Managed Identity does not allow you to connect to Office 365\\Azure out of the box, it's designed not to do this. What ensued was an uphill battle to assign the Exchange Admin role and API permissions via the command line to the System-assigned Managed Identity. I was just about ready to throw it out the window when I crumbled and deciced to use a service account (added credentials to the Automation Account) to get it up and running This was dissappointing on several levels, I really wanted to get this setup to not use any credentials, I guess that is a task for another day now, as for demonstration purposes, it works a treat! Anyway, that whole debacle cost me almost a full working day to get my head around, hopefully, my pain works for your gain...a good example of RTFM and don't force something to work, there's a good chance it's not meant too. Thanks for reading!","keywords":"IT  blog  Microsoft  Azure  Computers"},{"title":"What is Automation in Azure?","type":0,"sectionRef":"#","url":"/blog/What is Automation in Azure","content":"","keywords":"IT  blog  Microsoft  Azure  Computers"},{"title":"2. Pros and Cons of the Automation Approach​","type":1,"pageTitle":"What is Automation in Azure?","url":"/blog/What is Automation in Azure#2-pros-and-cons-of-the-automation-approach","content":"I may well be a little biased here but, in my experience, if the status quo is to prefer manual tasks. It will be hard going initially to get others to see the light that is automating away &quot;their&quot; jobs. I use quote marks there because, the typical Infrastructure role is changing rapidly. "},{"title":"2.1. Pros​","type":1,"pageTitle":"What is Automation in Azure?","url":"/blog/What is Automation in Azure#21-pros","content":"Reduce time to perform an action.Reduce risk in performing the action.Freeing up staff from the burden of manual tasks.Standardisation of tasks. "},{"title":"2.2. Cons​","type":1,"pageTitle":"What is Automation in Azure?","url":"/blog/What is Automation in Azure#22-cons","content":"Time consuming to implement in the first instance.Staff need training on the automation methods.You may encounter resistance when it comes to changing the status quo. "},{"title":"3. Tools at your disposal​","type":1,"pageTitle":"What is Automation in Azure?","url":"/blog/What is Automation in Azure#3-tools-at-your-disposal","content":"A very brief overview of the various tools that can be used, my first suggestion is to investigate the use of PowerShell and RunBooks; they've always seemed to make the most sense to start with. "},{"title":"3.1. PowerShell​","type":1,"pageTitle":"What is Automation in Azure?","url":"/blog/What is Automation in Azure#31-powershell","content":"This is an incredibly versatile tool that can be used to manage almost any resource on-prem and in the cloud. I'd suggest digging into the Azure CLI and also familiarising yourself with the Office 365 modules too (SharePoint Online, Exchange Online, Microsoft Teams, Azure Active Directory, more in-depth KBs and posts to follow on these. You aren't just restricted to using PowerShell from your machine running the Windows OS, you can also use an Automation Account with a PowerShell runbook, I'll upload a KB to get you started soon! Learn more about PowerShell here. "},{"title":"3.2. Azure Bicep​","type":1,"pageTitle":"What is Automation in Azure?","url":"/blog/What is Automation in Azure#32-azure-bicep","content":"Bicep is a declarative language, used to deploy Azure resources. In a Bicep file, you define what you want to deploy to Azure and then use that file to repeatedly deploy your infrastructure. It's a great tool to ensure consistency in your environments although, this is a separate language to learn and only applies to Azure. You can learn more about Bicep here. "},{"title":"3.3. Azure Logic Apps​","type":1,"pageTitle":"What is Automation in Azure?","url":"/blog/What is Automation in Azure#33-azure-logic-apps","content":"Logic Apps is a cloud platform\\service where you can create and run workflows in Azure (there's an Office 365 version with a cut-down toolset called Power Automate which is also really good). The major plus of using these is that they require little to no code at all to set up, it's all visual. Logic Apps integrate with most Office 365 and Azure services making them versatile, easy to maintain and accessible to people with less knowledge of coding. Learn more about Logic Apps here. Thanks for reading! I hope that gives you some idea of what options there are for automation in Azure, I'll be following up with another post of suggested processes you can automate both from suggestions online and from my experience. "},{"title":"AzCli Cheatsheet","type":0,"sectionRef":"#","url":"/docs/Azure CLi/AzCli Cheatsheet","content":"","keywords":"IT  blog  Microsoft  Azure  Computers"},{"title":"1. Connection​","type":1,"pageTitle":"AzCli Cheatsheet","url":"/docs/Azure CLi/AzCli Cheatsheet#1-connection","content":"Commands relating to connecting to the Azure CLi Command\tDescriptionaz login\tLogin to Azure tenant az account set --subscription &lt;subscription ID&gt;\tSet the scope for the session. "},{"title":"2. Object Management​","type":1,"pageTitle":"AzCli Cheatsheet","url":"/docs/Azure CLi/AzCli Cheatsheet#2-object-management","content":"Command\tDescriptionaz group list --output table\tList resource groups as a table. az group create --name exampleRG --location eastus\tCreate a resource group, with a name and location. "},{"title":"3. Deployment​","type":1,"pageTitle":"AzCli Cheatsheet","url":"/docs/Azure CLi/AzCli Cheatsheet#3-deployment","content":"Command\tDescriptionaz deployment list --output table\tList of deployments. az deployment group create --resource-group exampleRG --template-file main.bicep --parameters storageName=uniquename\tDeploy storage account into an existing Resource Group. "},{"title":"4. Delete Resources​","type":1,"pageTitle":"AzCli Cheatsheet","url":"/docs/Azure CLi/AzCli Cheatsheet#4-delete-resources","content":"Command\tDescriptionaz group delete --resource-group &lt;group name&gt;\tDelete resource group. "},{"title":"Azure Permission & Resource Management","type":0,"sectionRef":"#","url":"/blog/Azure Permission & Resource Management","content":"","keywords":"IT  blog  Microsoft  Azure  Computers"},{"title":"1. The 4 management levels​","type":1,"pageTitle":"Azure Permission & Resource Management","url":"/blog/Azure Permission & Resource Management#1-the-4-management-levels","content":"The below is nothing original by the way, I've lifted it and re-written the concepts into another format from a Microsoft docs article here, you may prefer their version. Organize your Azure resources effectively Management groups help to manage access via policy and compliance over multiple subscriptions. When a subscription is part of a management group, it'll automatically inherit all conditionas\\settings setup in the management group. Subscriptions logically associate permissions with resources they create. Each individual subscription has limits\\quotas regarding the amount of resources it can create\\use. Subscriptions also help to organise costs. Resource Groups are logical containers, where you can deploy Azure resources to; you could think of them being along the lines of Folders. You can also apply tags to help better manage resources and what they're for. Resources are instances of services that you can create. "},{"title":"2. Managing Access to resources​","type":1,"pageTitle":"Azure Permission & Resource Management","url":"/blog/Azure Permission & Resource Management#2-managing-access-to-resources","content":"We should always plan for the least privileges required to allow a team to work, the permission model in Azure is designed to allow this however, I'd say it is so granular that it generates more work that necessary in most cases. Here's a basic list from my experience setting up a permission model in the past; it covers a service desk team. Call Agent team - No access to Azure resources.Level 1, 2 and 3 teams - Reader access at the Subscription level, providing Contributor role at the Resource Group or Resource level where appropriate.Infrastructure - If the team also performs security functions, I would suggest the Contributor role be assigned of at the Subscription Level where appropriate and to assign the Owner role at the resource group level where the Infrastructure they &quot;own&quot; is situated. Permission elevation controls and experience levels should be taken into account. In previous companies, I'd trust the L2 team to have the same access as L3 and, in some cases I'd not even consider it! You can also control Service Desk team access using Change Control. Asking them to justify their access requirements via a change process not only allows others to check what they're doing, it could also show that they do not need to access rights in the first place. Speaking from experience, I'd highly recommend trusting your Infrastructure team to have the Contributor role at the Subscription level where possible. It will make a lot of difference to all teams &quot;quality of life&quot; if they've access to someone who can carry out actions they cannot. "},{"title":"3. Resource tagging​","type":1,"pageTitle":"Azure Permission & Resource Management","url":"/blog/Azure Permission & Resource Management#3-resource-tagging","content":"Tags can be an absolute godsent and can help you to quickly identify your resources and resource groups. You apply tags to your Azure resources and resource groups to logically organize them into categories. Tags can include context about the resource's associated workload or application, operational requirements, and ownership information. Some suggested uses for tags;Metadata and documentation, Admins can apply a tag to all resources matching a specific workload or project.Automation, you can target a tag for scripts etc.Cost analysis, this is the most common use case that I've come across for tags. Each resource or resource group can have a maximum of 50 tag name and value pairs. This limitation only applies to tags directly applied to the resource group or resource. That turned out to be a little longer than I'd hoped for, with any luck it'll be of some use. "},{"title":"Restore from Snapshot","type":0,"sectionRef":"#","url":"/docs/Azure Resources Management/Restore from Snapshot","content":"","keywords":"IT  blog  Microsoft  Azure  Computers"},{"title":"1. Create your snapshot​","type":1,"pageTitle":"Restore from Snapshot","url":"/docs/Azure Resources Management/Restore from Snapshot#1-create-your-snapshot","content":"Validate the Snapshot Make sure to check the SnapShot is valid before starting this process. Open the Azure portal, https://portal.azure.com.Navigate to a VM that is available to have a disk attached to it.Click on Disks on the left-hand side.Create a new disk.Click Edit on the far right hand side. As shown in red above.Name your Disk, I'd suggest, snapshot_ServerName_Date_TimeSource, Select snapshot.Select the Snapshot you wish to attach.Make any changes to the Encryption Type.I'd suggest it not to be a shared disk.Press Save. This shouldn't take too long. info If you see the error below, change the Host Caching option to &quot;none&quot;.  "},{"title":"2. Confirm disk is visibile in the OS​","type":1,"pageTitle":"Restore from Snapshot","url":"/docs/Azure Resources Management/Restore from Snapshot#2-confirm-disk-is-visibile-in-the-os","content":"tip The share should be available from the get go however, you may need to bring the disk online within computer management. RDP into your VM &amp; check File Explorer for your disk, the name will be what the share was called originally.Open Computer Management, Click Disk Management.Right-Click on the disk, mark it as Oneline. You should now see it in File Explorer. "},{"title":"3. Detach the disk​","type":1,"pageTitle":"Restore from Snapshot","url":"/docs/Azure Resources Management/Restore from Snapshot#3-detach-the-disk","content":"Close any open sessions to the disk that you attached.Navigate back to the VM in Azure Management Portal.Click the X button to the right-hand side of the disk. "},{"title":"Setup Azure Backup","type":0,"sectionRef":"#","url":"/docs/Azure Resources Management/Setup Azure Backup","content":"","keywords":"IT  blog  Microsoft  Azure  Computers"},{"title":"1. Create the below resources in the FW-Azure Production subscription​","type":1,"pageTitle":"Setup Azure Backup","url":"/docs/Azure Resources Management/Setup Azure Backup#1-create-the-below-resources-in-the-fw-azure-production-subscription","content":"info Use whatever naming conention fits in with what's being used already, I am just suggesting something here. Create the resource group, for example, rg-&lt;customername&gt;-&lt;region&gt;-&lt;prod/dev&gt;-backups-01.Create a recovery services vault to store the backups (GRS is the preferred option, LRS for lowest cost), for example, rsv-&lt;customername&gt;-&lt;region&gt;-&lt;prod/dev&gt;-backup-01.Create a log analytics workspace or reuse another one, for example, la-&lt;customername&gt;-&lt;region&gt;-&lt;prod/dev&gt;-backup-01. "},{"title":"2. Configure Backup Policy​","type":1,"pageTitle":"Setup Azure Backup","url":"/docs/Azure Resources Management/Setup Azure Backup#2-configure-backup-policy","content":"Configure the backup policy in-line with whatever standard is being used already, my suggestions are below. In the Azure portal, select a Recovery Services vault to back up the VM.Under Backup, select Backup Policies.Click +Add.On Select policy type, select Azure Virtual Machine.On Create policy, perform the following actions: Policy sub type: StandardSuggested Name format: Bkup-policy-&lt;time of day&gt;-&lt;policy type&gt; (example name: bkup-policy-nightly-std).  "},{"title":"3. Configure Alerting​","type":1,"pageTitle":"Setup Azure Backup","url":"/docs/Azure Resources Management/Setup Azure Backup#3-configure-alerting","content":"tip Note that this method is using the old backup alerting method, this is being replaced by Azure Monitor. Microsoft Link for more information Configure diagnostic logs to be sent from Azure Backup to the Log Anlytics workspace above. From the Recovery services vault just setup. Click on Backup Alerts, under the Monitoring section.Click Configure Notifications. Enable Notifications: YesRecipients(Email): monitoring@DomainName.comNotify: Hourly digestSeverity: Critical &amp; Warning Example of this below. "},{"title":"4. Configure Diagnostic log collection​","type":1,"pageTitle":"Setup Azure Backup","url":"/docs/Azure Resources Management/Setup Azure Backup#4-configure-diagnostic-log-collection","content":"Configure diagnostic logs to be sent from Azure Backup to the Log Anlytics workspace above. Navigate to Diagnostic settings under Monitoring.Click Add Diagnostic Settings.Name your diagnostic setting, something informational, for example, &quot;AzBkup-Diagnostics&quot;, suggestion, Backup Report Data.Select Send to Log Analytics Workspace.Add a workspace and don't touch any other settings.Hit Save. tip Make sure to run the initial backup job from the Azure Backup Dashboard. "},{"title":"Resizing a Virtual Machine","type":0,"sectionRef":"#","url":"/docs/Azure Resources Management/Resizing a Virtual Machine","content":"","keywords":"IT  blog  Microsoft  Azure  Computers"},{"title":"1. Before you begin​","type":1,"pageTitle":"Resizing a Virtual Machine","url":"/docs/Azure Resources Management/Resizing a Virtual Machine#1-before-you-begin","content":"Shutdown the VM from within it's OS if possible (Not always necessary at all but, nice to do).If you cannot see the VM size that you're looking for it may not be compatible with your VM. You can have too many disk or NICs attached to the VM for the size you want. The typ of disks that you have attached can limit your options, premium and standard tier. "},{"title":"2. Re-siging the vm​","type":1,"pageTitle":"Resizing a Virtual Machine","url":"/docs/Azure Resources Management/Resizing a Virtual Machine#2-re-siging-the-vm","content":"De-allocating a VM can cause issues! De-allocating the VM also releases any dynamic IP addresses assigned to the VM. The OS and data disks are not affected. At the same time, you're releasing your ownership of the size of that VM. If you are resizing a production VM, consider using Azure Capacity Reservations to reserve Compute capacity in the region; otherwise you may have to pick another size. Open the Azure portal, https://portal.azure.com.Search for your virtual machine.In the left menu, Select Size.Choose the new size from the list of available sizes and then Select Resize. "},{"title":"Create an Automation Account","type":0,"sectionRef":"#","url":"/docs/Azure Resources Management/Automation in Azure/Create an Automation Account","content":"","keywords":"IT  blog  Microsoft  Azure  Computers"},{"title":"Outline​","type":1,"pageTitle":"Create an Automation Account","url":"/docs/Azure Resources Management/Automation in Azure/Create an Automation Account#outline","content":"Setup the Resource Group and Automation Account.Setup the Identity for the Automation Account, this is key to running scripts gainst Azure Active Directoy and Office 365 resources.Create ourselves a Runbook, that sits inside the Automation Account.Install the relevant modules for the code we want to run.Write ourselves a little script.Setup a schedule for the Runbook. "},{"title":"Assign Managed Identity permissions via CMDLine","type":0,"sectionRef":"#","url":"/docs/Azure Resources Management/Automation in Azure/Assign Managed Identity permissions via CMDLine","content":"","keywords":"IT  blog  Microsoft  Azure  Computers"},{"title":"1. The command​","type":1,"pageTitle":"Assign Managed Identity permissions via CMDLine","url":"/docs/Azure Resources Management/Automation in Azure/Assign Managed Identity permissions via CMDLine#1-the-command","content":" # Your tenant id. $TenantID=&quot;Add your tenant ID&quot; # Microsoft Graph App ID (DON'T CHANGE). $GraphAppId = &quot;00000003-0000-0000-c000-000000000000&quot; # Name of the manage identity (same as the Logic App name). $DisplayNameOfMSI=&quot;Add display name of Enterprise App&quot; # Check the Microsoft Graph documentation for the permission you need for the operation. $PermissionName = &quot;Add your permission here&quot; # Install the module (You need admin on the machine) Install-Module AzureAD # Connect to Azure AD via tenant ID, you'll need an admin account to login with though. Connect-AzureAD -TenantId $TenantID # Collects the Target System Managed Identities information into the MSI variable. $MSI = (Get-AzureADServicePrincipal -Filter &quot;displayName eq '$DisplayNameOfMSI'&quot;) Start-Sleep -Seconds 10 # Store the Microsoft Graph API informaiton into the GraphServicePrincipal variable. $GraphServicePrincipal = Get-AzureADServicePrincipal -Filter &quot;appId eq '$GraphAppId'&quot; # Searches Microsoft Graph API for the value matching the PermissionName variable populated above and stores this in the AppRole Variable. $AppRole = $GraphServicePrincipal.AppRoles | Where-Object {$_.Value -eq $PermissionName -and $_.AllowedMemberTypes -contains &quot;Application&quot;} # Assigned the permission from the Microsoft Graph API to the target Managed Identity. New-AzureADServiceAppRoleAssignment -ObjectId $MSI.ObjectId -ResourceId $GraphServicePrincipal.ObjectId -Id $appRole.Id -PrincipalId $MSI.ObjectId  Annotated the hell out of it as the command really confused me. "},{"title":"2. Notes​","type":1,"pageTitle":"Assign Managed Identity permissions via CMDLine","url":"/docs/Azure Resources Management/Automation in Azure/Assign Managed Identity permissions via CMDLine#2-notes","content":"It takes a few minutes for this change to show in the GUI.If the permission already exists the promtp will error on the final command. "},{"title":"Resource Creation Cheatsheet","type":0,"sectionRef":"#","url":"/docs/Azure Resources Management/Resource Creation Cheatsheet","content":"","keywords":"IT  blog  Microsoft  Azure  Computers"},{"title":"1. Before you begin​","type":1,"pageTitle":"Resource Creation Cheatsheet","url":"/docs/Azure Resources Management/Resource Creation Cheatsheet#1-before-you-begin","content":"info This information is down to personal experience and issues that I have come across when dealing with a customer requesting a new resource. Define the workload, this will help understand the size of the resource needed, consider growth over time as well.Costing, be prepared to provide estimates and justify the need to your solution; pay as you go is all well and good but, it can mount up quick.Consider dependancies before you starting the build, for example: Do you need a new Subscription?Do you need to create a Resources Group?Network Connectivity, do you need a private endpoint and network connectivity? Do you need people to connect externally to the resources? Monitoring and Alerting, what needs setting,?Backups, do you need them\\it?Security, what features need to be enabled?Resiliency, does the resource and depedant resources need to be resilient?Tags, tags are useful for billing, reporting and segregating resources. Suggested naming conventions here. Data Sovereignty, no good setting up resiliency to a region outside of the customer location if it's not allowed to be there!Estimate build time and get approval to create any resources.Testing, consider as well, how you will test out the build. Do you have test data to migrate as part of this work? "},{"title":"2. Other recommendations​","type":1,"pageTitle":"Resource Creation Cheatsheet","url":"/docs/Azure Resources Management/Resource Creation Cheatsheet#2-other-recommendations","content":""},{"title":"2.1. Naming Conventions​","type":1,"pageTitle":"Resource Creation Cheatsheet","url":"/docs/Azure Resources Management/Resource Creation Cheatsheet#21-naming-conventions","content":"tip The below bullet points apply to the Subsciption, Resource Group and the SQL resource. Almost nothing in Azure can be renamed after creation. You'll have to delete and start over. Names must be in lowercase, Azure does not support uppercase names. Name objects appropriately based on it's purpose. If it hosts production resources, include Production\\Prod in the name.If it hosts developement resources, include Development\\Dev in the name.If it hosts resources for a particular application or solution, include that app or solution name.Example naming convention, &quot;Company&quot;-&quot;environment type&quot;-&quot;Region&quot;-&quot;Resource information&quot;. "},{"title":"Size and Sku​","type":1,"pageTitle":"Resource Creation Cheatsheet","url":"/docs/Azure Resources Management/Resource Creation Cheatsheet#size-and-sku","content":"Triple check the sizes available using the Azure portal, the Azure pricing calculator has no awareness of what is actaully available in a region. "},{"title":"2.2. Resource grouping​","type":1,"pageTitle":"Resource Creation Cheatsheet","url":"/docs/Azure Resources Management/Resource Creation Cheatsheet#22-resource-grouping","content":"Resources within Resource Groups should share the same product life cycle.Many resources cannot be moved between groups after they've been created.Example naming convention, &quot;Company&quot;-&quot;environment type&quot;-&quot;Region&quot;-&quot;Resource information&quot;. "},{"title":"2.4. Monitoring​","type":1,"pageTitle":"Resource Creation Cheatsheet","url":"/docs/Azure Resources Management/Resource Creation Cheatsheet#24-monitoring","content":"You can create Alerts in the Azure portal much like any other resource. You'll be required to pick from the &quot;suggested&quot; metrics. Microsoft docs link - Create alerts for Azure SQL Database.You can monitor SQL Databases with Azure Monitor, Microsoft docs link - Monitor Azure SQL Database with Azure Monitor. "},{"title":"Resource Specific Notes​","type":1,"pageTitle":"Resource Creation Cheatsheet","url":"/docs/Azure Resources Management/Resource Creation Cheatsheet#resource-specific-notes","content":""},{"title":"Azure SQL Server and Database​","type":1,"pageTitle":"Resource Creation Cheatsheet","url":"/docs/Azure Resources Management/Resource Creation Cheatsheet#azure-sql-server-and-database","content":"Authentication method, where apprproate, use both SQL and Azure AD, that covers both sides unless the user specifies otherwise.Network Connectivity, this can be a bit of a mess for SQL servers and Databases in Azure, I'd suggest digging into this a bit to see what fits best for your deplyment. By default, the databse\\sql server will be contactable by any resource in your Azure tenant provided it's not on a VNet already. External connectivity can be done through the network settings on the resource as is basically direct connect if no Private endpoint is setup. "},{"title":"What can you Automate","type":0,"sectionRef":"#","url":"/blog/What can you Automate","content":"","keywords":"IT  blog  Microsoft  Azure  Computers"},{"title":"1. Joiner, Mover and Leaver Processes​","type":1,"pageTitle":"What can you Automate","url":"/blog/What can you Automate#1-joiner-mover-and-leaver-processes","content":"If you're or, have worked in a Service Desk role level 1 upwards, you'll be well aware of the pain that is administering user accounts. The amount of time spent correcting someone's first or last name is crazy! In my experience, we squashed a lot of the mistakes by automating the process as much as possible. I've done this using PowerShell and getting the Service Desk staff to submit the new starter or leaver data into the form. I'll upload this script to the Github repo, please note that the script is targeted at hybrid environments. "},{"title":"2. Certificate & Secret Management for Azure AD​","type":1,"pageTitle":"What can you Automate","url":"/blog/What can you Automate#2-certificate--secret-management-for-azure-ad","content":"Azure AD is a wonderful tool but, it can be super complex to manage and keep track of what's going on within it. One such task is making sure that none of the App Registrations has a soon-to-expire certificate or secret. The best solution to this is tracking your certs in some fashion however, whatever solution you chose to use, if someone adds a new App Registration then that may not be picked up. Link to a script created by Microsoft, here. "},{"title":"3. Reporting​","type":1,"pageTitle":"What can you Automate","url":"/blog/What can you Automate#3-reporting","content":"Something that has always come up is keeping an accurate asset inventory for Azure AD joined devices as well as all of the other types captured within Intune. Since Intune does not have its own PowerShell module (I think, I did find this however from Microsoft's Github!), you'd need to rely on one of the Microsoft portals for a report, which isn't too annoying to get in real terms. An automated method would be to create a script to connect to Azure AD, retrieve device information and dump this out into Excel for someone to review. You could host this in an Automation account in Azure to run automatically. "},{"title":"4. Patch Management​","type":1,"pageTitle":"What can you Automate","url":"/blog/What can you Automate#4-patch-management","content":"At the moment, you can patch your VM estate using an Automation account rather than relying on running your own WSUS server, of course, if you want to control the flow better in line with any on-prem infrastructure that'd be the way to go; I'd still suggest letting Microsoft patch them though, it's remarkably good and a great quality of life update for your engineers! On a side note, I believe Microsoft has just released Update management centre which is its own service in Azure to replace the Automation account method mentioned above. Learn more about Update Management Centre,here. "},{"title":"5. Configuration Management​","type":1,"pageTitle":"What can you Automate","url":"/blog/What can you Automate#5-configuration-management","content":"Automation of resource creation and also management is a great use of this technology. As I've mentioned previously, Bicep and PowerShell will let you do this, along with Terraform which works well with Azure. Other languages will let you do this but, I have only used the three mentioned above. Thanks for reading! "},{"title":"AutoPilot Reset","type":0,"sectionRef":"#","url":"/docs/Intune/AutoPilot Reset","content":"","keywords":"IT  blog  Microsoft  Azure  Computers"},{"title":"1. Prerequisit Steps in Intune​","type":1,"pageTitle":"AutoPilot Reset","url":"/docs/Intune/AutoPilot Reset#1-prerequisit-steps-in-intune","content":"Logon to Microsoft Endpoint Manager admin centre: https://endpoint.microsoft.com/ "},{"title":"1.1. Confirm the device has the correct group tag​","type":1,"pageTitle":"AutoPilot Reset","url":"/docs/Intune/AutoPilot Reset#11-confirm-the-device-has-the-correct-group-tag","content":"Ignore this step if you know you do not use group tags. Sometimes group tags within Autopilot are used to assign device profiles\\policies after the device has been enrolled. This group tag must be correct otherwise it'll interfer with the reset. Click Devices &gt; Windows &gt; Windows Enrollment &gt; Devices.Find the Serial number of the device and search it here.Click on your device, alter group tag** here to the correct one.Click Save Wait for the profile status to change to assigned, this is automatic and can take 5 - 10 minutes. "},{"title":"2. Initiate the reset​","type":1,"pageTitle":"AutoPilot Reset","url":"/docs/Intune/AutoPilot Reset#2-initiate-the-reset","content":"The Windows device MUST have a stable internet connection to complete this process. Click Devices &gt; Windows &gt; Windows Devices, it should already be on this option.Search for your device and click on the device name.Click the Autopilot Reset option.Click Yes. Wait for the Windows device to reset, it must maintain internet connection throughout this process. "},{"title":"3. On the device​","type":1,"pageTitle":"AutoPilot Reset","url":"/docs/Intune/AutoPilot Reset#3-on-the-device","content":"Make sure the machine is powered on and connected to an internet source.The Autopilot process should start automatically.When the option appears, select Windows Autopilot provisioning. Autopilot should take over from here and reset the device.  Once completed you should then be returned to a login prompt.  "},{"title":"Manging AD with PowerShell","type":0,"sectionRef":"#","url":"/docs/PowerShell/Manage Active Directory with PowerShell","content":"","keywords":"IT  blog  Microsoft  Azure  Computers"},{"title":"Filter by an attribute​","type":1,"pageTitle":"Manging AD with PowerShell","url":"/docs/PowerShell/Manage Active Directory with PowerShell#filter-by-an-attribute","content":" # Filter mail address is like &amp; the user has to be enabled. Get-ADUser -Filter &quot;Mail -like '*@&lt;domain&gt;co.uk' -and enabled -eq '$true'&quot; | Select Name, UserPrincipalname # Fitler where user is disabled. Get-ADUser -Filter 'enabled -eq $false' | Select name, DistinguishedName  "},{"title":"Take ownership of customer azure subscription","type":0,"sectionRef":"#","url":"/docs/Microsoft Partner Centre/take ownership of customer azure subscription","content":"Take ownership of customer azure subscription Microsoft Article: Reinstate admin privileges for a customer's Azure CSP subscriptions. # Connect to Sub. Connect-AzAccount -TenantID &quot;&lt;Customer TenantID&gt;&quot; # Set the subscription context you want to add partner permissions too. Set-AzContext -SubscriptionID &quot;&lt;Customer Subscription ID&gt;&quot; # Assign the &quot;adminagents&quot; group in Partner tenant to the customer subscription New-AzRoleAssignment -ObjectID &quot;&lt;Object ID of the AdminAgents group from step 7 of your actions section&gt;&quot; -RoleDefinitionName &quot;Owner&quot; -Scope &quot;/subscriptions/&lt;CSP subscription ID&gt;&quot; -ObjectType &quot;ForeignGroup&quot; ","keywords":"IT  blog  Microsoft  Azure  Computers"},{"title":"Sending Logs to Log Analytics","type":0,"sectionRef":"#","url":"/docs/Intune/Sending Logs to Log Analytics","content":"","keywords":"IT  blog  Microsoft  Azure  Computers"},{"title":"1.1. Logs that can be ingested​","type":1,"pageTitle":"Sending Logs to Log Analytics","url":"/docs/Intune/Sending Logs to Log Analytics#11-logs-that-can-be-ingested","content":"Microsoft Intune includes built-in logs that provide information about your environment: Audit Logs shows a record of activities that generate a change in Intune, including create, update (edit), delete, assign, and remote actions.Operational Logs show details on users and devices that successfully (or failed) to enroll, and details on non-compliant devices.Device Compliance Organizational Logs show an organizational report for device compliance in Intune, and details on non-compliant devices.IntuneDevices show device inventory and status information for Intune enrolled and managed devices. "},{"title":"1.2. Notes​","type":1,"pageTitle":"Sending Logs to Log Analytics","url":"/docs/Intune/Sending Logs to Log Analytics#12-notes","content":""},{"title":"1.2.1. Benefits​","type":1,"pageTitle":"Sending Logs to Log Analytics","url":"/docs/Intune/Sending Logs to Log Analytics#121-benefits","content":"The main benefit of using Log Analytics is the visualisation, monitoring, and alerting on the connected data.Archive the data to review at a later date.Stream the logs into Azure Event hub for review in other 3rd party tools. "},{"title":"1.2.2. Cons (Sort of)​","type":1,"pageTitle":"Sending Logs to Log Analytics","url":"/docs/Intune/Sending Logs to Log Analytics#122-cons-sort-of","content":"All of the above logs can be found within the Intune portal, login to EndPoint Manager (Intune) &gt; Devices &gt; Monitor. Audit Logs - login to EndPoint Manager (Intune) &gt; Devices &gt; Monitor &gt; Other &gt; Device actions.Operational Logs - login to EndPoint Manager (Intune) &gt; Devices &gt; Monitor &gt; Enrollment &gt; Enrollment Failures .and login to EndPoint Manager (Intune) &gt; Devices &gt; Monitor &gt; Compliance &gt; Noncompliant devices.Device Compliance Organizational Logs - login to EndPoint Manager (Intune) &gt; Reports &gt; Device compliance.IntuneDevices - login to EndPoint Manager (Intune) &gt; Devices &gt;All Devices. "},{"title":"Setup sending data​","type":1,"pageTitle":"Sending Logs to Log Analytics","url":"/docs/Intune/Sending Logs to Log Analytics#setup-sending-data","content":"Microsoft link to instructions to set this up. "},{"title":"Cost estimations and Dependancies​","type":1,"pageTitle":"Sending Logs to Log Analytics","url":"/docs/Intune/Sending Logs to Log Analytics#cost-estimations-and-dependancies","content":"Microsoft link - Storage size for activity logs. "},{"title":"Setup an Azure Subscription from Partner Centre","type":0,"sectionRef":"#","url":"/docs/Microsoft Partner Centre/Setup an Azure Subscription from Partner Centre","content":"","keywords":"IT  blog  Microsoft  Azure  Computers"},{"title":"1.1. Before you begin​","type":1,"pageTitle":"Setup an Azure Subscription from Partner Centre","url":"/docs/Microsoft Partner Centre/Setup an Azure Subscription from Partner Centre#11-before-you-begin","content":"Who'll manage this subscription? If it's being setup with the CSP in mind, it'll be the CSP. Who'll be supporting this subscription? Will it be added to BAU.What Groups and\\or accounts need to manage it, (Owner, Contributor, Reader). "},{"title":"1.2. Setup Process​","type":1,"pageTitle":"Setup an Azure Subscription from Partner Centre","url":"/docs/Microsoft Partner Centre/Setup an Azure Subscription from Partner Centre#12-setup-process","content":"Microsoft Link. Sign in to the Azure portal using your Partner Center account.Make sure you are in your Partner Center directory (tenant), not a customer’s tenant.Navigate to Cost Management + Billing.Select the Billing scope for your billing account where the customer account resides.In the left menu under Billing, select Customers.On the Customers page, select the customer. If you have only one customer, the selection is unavailable.In the left menu, under Products + services, select All billing subscriptions.On the Azure subscription page, select + Add to create a subscription.Then select the type of subscription to add. For example, Usage based/ Azure subscription.On the Basics tab, enter a subscription name.Select the partner's billing account.Select the partner's billing profile.Select the customer that you're creating the subscription for and, if applicable, select a reseller.Next to Plan, select Microsoft Azure Plan for DevTest, if the subscription will be used for development or testing workloads. Otherwise, select Microsoft Azure Plan.Optionally, select the Tags tab and then enter tag pairs for Name and Value.Select Review + create. You should see a message stating Validation passed.Verify that the subscription information is correct, then select Create. You'll see a notification that the subscription is getting created. The customer will see the new subscription appear for them within 60 minutes, they may need to amend the subscription filter to see the new sub. If the end user you're testing with is not in the root managemnt group, you'll need to grant them a role over the Subscription before they can see it. "},{"title":"Approve or Block an App","type":0,"sectionRef":"#","url":"/docs/Teams/Approve or Block an App","content":"","keywords":"IT  blog  Microsoft  Azure  Computers"},{"title":"1. Steps to complete​","type":1,"pageTitle":"Approve or Block an App","url":"/docs/Teams/Approve or Block an App#1-steps-to-complete","content":"Login to Teams Admin Centre, https://admin.teams.microsoft.com/Click Teams Apps &gt; Manage apps.In the section towards the bottom of the page, search for the applicaton and select it.Click on Allow or Block in the action bar above the list. "},{"title":"Prettier Terminal Window","type":0,"sectionRef":"#","url":"/docs/PowerShell/Prettier Terminal Window","content":"","keywords":"IT  blog  Microsoft  Azure  Computers"},{"title":"Install the Windows Terminal App​","type":1,"pageTitle":"Prettier Terminal Window","url":"/docs/PowerShell/Prettier Terminal Window#install-the-windows-terminal-app","content":"Download it free from the Microsoft store, once installed run the terminal application. If you're doing this on a domain joined machine, you'll need to run the terminal application on both the user account and the administrator account to create the profiles. "},{"title":"Install OH-MY-POSH​","type":1,"pageTitle":"Prettier Terminal Window","url":"/docs/PowerShell/Prettier Terminal Window#install-oh-my-posh","content":"Follow these instructions for Windows machines, this is the official website. I recommend using winget via PowerShell to get the stuff. winget install JanDeDobbeleer.OhMyPosh -s winget  "},{"title":"Download fonts from Nerd Fonts​","type":1,"pageTitle":"Prettier Terminal Window","url":"/docs/PowerShell/Prettier Terminal Window#download-fonts-from-nerd-fonts","content":"These are some instructions from the Oh My Posh site to do this. In your terminal prompt, type oh-my-posh font install, this should then install the on my posh font. Next you need to configure the Terminal app to use the new font. You can edit the JSON file or you can do it in the GUI by clicking on the down arrow next to your open tab in Terminal. Click Settings, then click Defaults and click Appearance. Click on the font list next to the option, Font Face, select the Oh my posh font. "},{"title":"Edit the PowerShell profile​","type":1,"pageTitle":"Prettier Terminal Window","url":"/docs/PowerShell/Prettier Terminal Window#edit-the-powershell-profile","content":"Check out this link for the source matierial for the below Edit your PowerShell profile script, you can find its location under the $PROFILE variable in your preferred PowerShell version. For example, using notepad, notepad $PROFILE. If the command errors, you will need to create the profiel first, New-Item -Path $PROFILE -Type File -Force. Inside your profile, add the following line into it. oh-my-posh init pwsh --config 'C:/Users/Posh/jandedobbeleer.omp.json' | Invoke-Expression  If you want to change the theme, navigate to the theme folder, if you don't know where that is, enter the following command (Get-Command oh-my-posh).Source. "},{"title":"Other suggestions​","type":1,"pageTitle":"Prettier Terminal Window","url":"/docs/PowerShell/Prettier Terminal Window#other-suggestions","content":""},{"title":"Install PSReadLine​","type":1,"pageTitle":"Prettier Terminal Window","url":"/docs/PowerShell/Prettier Terminal Window#install-psreadline","content":"This module shows autocomplete suggestions based on the recent commands you've run, it's a great addition. Reference blog post from the Microsoft DevBlogs. Install the module, Install-Module PSReadLine. You need version 2.1.0 or higher for this to work properly. Enable Predictive IntelliSense by running this command, Set-PSReadLineOption -PredictionSource History, you should then start to see grey text in your PowerShell prompt that's running currently. The default key binding to use the prediction is right-arrow. You can change the color for those predictions by using the following commands. Set-PSReadLineOption -Colors @{ InlinePrediction = '#8A0303'} # This is dark red. Set-PSReadLineOption -Colors @{ InlinePrediction = '#2F7004'} # This is a dark green. # This will set it back to default. Set-PSReadLineOption -Colors @{ InlinePrediction = &quot;$([char]0x1b)[36;7;238m&quot;}  Make sure to update your PowerShell profile to load this module. Type notepad $profile into your terminal window, this should load your profile into notepad. Paste in the following lines. Set-PSReadLineOption -PredictionSource History Set-PSReadLineOption -PredictionViewStyle ListView  "},{"title":"Welcome to the Wiki","type":0,"sectionRef":"#","url":"/docs/Welcome to the Wiki","content":"","keywords":"IT  blog  Microsoft  Azure  Computers"},{"title":"How the site works​","type":1,"pageTitle":"Welcome to the Wiki","url":"/docs/Welcome to the Wiki#how-the-site-works","content":"The website is stored within a GitHub Repo, this is then copied over to a Static Web App hosted in Azure using a GitHub action. The site is generated using Docusaurus, big shout to them for making this incredible beast! "},{"title":"Navigating the Wiki​","type":1,"pageTitle":"Welcome to the Wiki","url":"/docs/Welcome to the Wiki#navigating-the-wiki","content":"Naviagte using the navbar on the left hand side.There is a search bar in the top right, try searching keywords for what you're after. "},{"title":"Contact Me​","type":1,"pageTitle":"Welcome to the Wiki","url":"/docs/Welcome to the Wiki#contact-me","content":"I'm running this site for others and myself to use, should something be wrong then I would love to hear from you. Drop me an email at, admin@itjamm.co.uk "},{"title":"PwshCli CheatSheet","type":0,"sectionRef":"#","url":"/docs/PowerShell/PwshCli CheatSheet","content":"","keywords":"IT  blog  Microsoft  Azure  Computers"},{"title":"1. Command Syntax Help​","type":1,"pageTitle":"PwshCli CheatSheet","url":"/docs/PowerShell/PwshCli CheatSheet#1-command-syntax-help","content":"Command\tDescriptionGet-help &lt;command you want help with&gt;\tWill return cmd syntax. Get-help &lt;command you want help with&gt; -example\tWill return cmd examples (if available. Get-Command\tWill return all available comamnds from installed modules. Get-Command -Name Get-*\tWill search from whatever string between, after or before wildcards *. "},{"title":"2. Troubleshooting Commands​","type":1,"pageTitle":"PwshCli CheatSheet","url":"/docs/PowerShell/PwshCli CheatSheet#2-troubleshooting-commands","content":"Command\tDescriptionGet-NetIPAddress -All\tReturns IPv4 and IPv6 configuration data and information about the interfaces those addresses are associated with. Get-NetIPConfiguration\tReturns networking configuration, including usable interfaces, IP addresses, and DNS servers. Test-NetConnection\tWill run a ping and TCP connection to the designated destionation. Test-NetConnection -port 8080 -ComputerName imagine01\tWill run a ping and TCP connection to the designated destionation on the chosen port. dsregcmd /status\tWill return the Azure Active Directory configuration of a machine. "},{"title":"3. Variables​","type":1,"pageTitle":"PwshCli CheatSheet","url":"/docs/PowerShell/PwshCli CheatSheet#3-variables","content":"Variables are useful for storing data that will need to referenced or used later on, perfect for making scripts. You can store all types of information in variables for example, commands, results, names, paths, settings and values. Microsoft link - Long Description of Variables. There are a few types of variables: Automatic variables, these can be refernced, for example, $PSHOME or $PROFILE, these cannot be changed.User-created variables, the user creates these and can freely, delete and change them.Preference variables, these variables store user preferences for PowerShell, for example, the $MaximumHistoryCount. Example of User-Crated variables $MyVariable = 1, 2, 3 $Path = &quot;C:\\Windows\\System32&quot;  "},{"title":"Managing Backup Jobs","type":0,"sectionRef":"#","url":"/docs/Veeam Backup for O365/Managing Backup Jobs","content":"","keywords":"IT  blog  Microsoft  Azure  Computers"},{"title":"1. Before you begin​","type":1,"pageTitle":"Managing Backup Jobs","url":"/docs/Veeam Backup for O365/Managing Backup Jobs#1-before-you-begin","content":"Veeam best practice guide link, here.Veeam User guide link, here. "},{"title":"2. Recommendations​","type":1,"pageTitle":"Managing Backup Jobs","url":"/docs/Veeam Backup for O365/Managing Backup Jobs#2-recommendations","content":""},{"title":"2.1. Split-up the jobs​","type":1,"pageTitle":"Managing Backup Jobs","url":"/docs/Veeam Backup for O365/Managing Backup Jobs#21-split-up-the-jobs","content":"This was a recommendation from the good folks at Veeam. Try to split the jobs based on size being backed up. An example of a suggestion below. Create a single job to capture anything that is new.If you've got loads of small SharePoint sites, split them into chunks as these will take a long time to backup. A few thousand of these will take hours to backup. For example, take the largest 10 sites and put them in their own jobs.The SharePoint backup job will also back personal sites as well, no need to include the personal sites in the other jobs. "},{"title":"2.2. Server resources & Backup App Registrations​","type":1,"pageTitle":"Managing Backup Jobs","url":"/docs/Veeam Backup for O365/Managing Backup Jobs#22-server-resources--backup-app-registrations","content":"Both resources (CPU &amp; RAM) play a major role in the performance of the proxy server. Make sure you don't go beneath 4vCPUs &amp; 16GB of RAM, below this and you'll start to see a noticable time incrase in backups.For the moment you can add more backup applications into Azure AD, that increases the amount of requests that can be made to the Office 365 resources. The more backup applications you have the quicker you'll exhaust the amount of requests that can be made per minute by the VBO solution to backup the data. "},{"title":"2.3. Microsoft Throttling​","type":1,"pageTitle":"Managing Backup Jobs","url":"/docs/Veeam Backup for O365/Managing Backup Jobs#23-microsoft-throttling","content":"After speaking with Microsoft, they no longer change the throttling limits upon request.You're limited due to the size of your organisation and amount of users, check out the link below for more information on throttling. Microsoft Link - Avoid getting throttled or blocked in SharePoint Online. "},{"title":"3. Object Management​","type":1,"pageTitle":"Managing Backup Jobs","url":"/docs/Veeam Backup for O365/Managing Backup Jobs#3-object-management","content":"Setup an Azure AD group to capture user objects that need to be excluded from the backups.Microsoft 365 Groups require an owner to be backed up, otherwise they'll generate warnings in your jobs. "},{"title":"Restore Errors","type":0,"sectionRef":"#","url":"/docs/Veeam Backup for O365/Restore Errors","content":"","keywords":"IT  blog  Microsoft  Azure  Computers"},{"title":"1. Failing to open mailbox​","type":1,"pageTitle":"Restore Errors","url":"/docs/Veeam Backup for O365/Restore Errors#1-failing-to-open-mailbox","content":""},{"title":"1.1. Scenario​","type":1,"pageTitle":"Restore Errors","url":"/docs/Veeam Backup for O365/Restore Errors#11-scenario","content":"Your Veeam Backup for Office 365 solution is pretty new and it's being tested or you've a member of your team who always gets this error for some reason. "},{"title":"1.2. The error​","type":1,"pageTitle":"Restore Errors","url":"/docs/Veeam Backup for O365/Restore Errors#12-the-error","content":"Failed to access mailbox. Mailbox does not exist. This issue mostly presents that error when you're using Modern Authentication. "},{"title":"1.3. Solution​","type":1,"pageTitle":"Restore Errors","url":"/docs/Veeam Backup for O365/Restore Errors#13-solution","content":"It turns out that in order to restore objects the user who authenticates to do the restore action must have the impersonation role, this is a custom role that you need to create via command line.  "},{"title":"Removing data and licenses","type":0,"sectionRef":"#","url":"/docs/Veeam Backup for O365/Removing data and licenses","content":"","keywords":"IT  blog  Microsoft  Azure  Computers"},{"title":"1. References​","type":1,"pageTitle":"Removing data and licenses","url":"/docs/Veeam Backup for O365/Removing data and licenses#1-references","content":"Veeam Blog post - How to remove a license from a user in Veeam Backup for Microsoft Office 365. Veeam Rest API Reference - Revoking Licenses from users. "},{"title":"2. Overview​","type":1,"pageTitle":"Removing data and licenses","url":"/docs/Veeam Backup for O365/Removing data and licenses#2-overview","content":"To remove a license from a user, you first need to delete that user’s data from all configured repositories and run the remove license command with PowerShell. This can be useful if you accidently backed up a user and no longer need to keep the data. Otherwise, you must wait the 31-day threshold for the license to be reallocated. "},{"title":"3. Checking for stored data​","type":1,"pageTitle":"Removing data and licenses","url":"/docs/Veeam Backup for O365/Removing data and licenses#3-checking-for-stored-data","content":"Firstly, you'll need to check if there is any data stored for the user you want to remove the licnese from. Open the Veeam Backup console on your application host, select the hamburger menu in the top left, navigate to Console and click on PowerShell. # This script will show you what a data a user has on a particular repository # Fill in &quot;REPOSITORY&quot; with the name of the repository as it is showing in # Veeam Backup for Office 365 and the email address of the user you wish to remove the data for &quot;USER@DOMAIN.com&quot; $repository = Get-VBORepository -Name &quot;REPOSITORY&quot; $user = Get-VBOEntityData -Type User -Repository $repository -Name &quot;USER@DOMAIN.com&quot; $user  Provided the command above runs successfully, you'll get a table returned showing the repositories as headings, with True or False under them depending on whether the user has data in them. "},{"title":"4. Delete the user data from each repo​","type":1,"pageTitle":"Removing data and licenses","url":"/docs/Veeam Backup for O365/Removing data and licenses#4-delete-the-user-data-from-each-repo","content":"I won't regurgitate the perfectly good Veeam article, the link is below for all of the commands needed. How to remove a license from a user in Veeam Backup for Microsoft Office 365. Make sure to follow each section in the rough order of the article, skip over the ones where your user has no data. "},{"title":"5. Issues​","type":1,"pageTitle":"Removing data and licenses","url":"/docs/Veeam Backup for O365/Removing data and licenses#5-issues","content":"I ended up having to raise a support request in the end as I had some troublesome admin users who'd had their data backed up in error. I was asked by the support team member who helped me to not store the script that was used. "},{"title":"5.1. Commands returning \"Null\"​","type":1,"pageTitle":"Removing data and licenses","url":"/docs/Veeam Backup for O365/Removing data and licenses#51-commands-returning-null","content":"Some of the commands above for some reason will return a “null” error when using them, you will need to pipe the command into a search to find the relevant data. Get-VBOLicensedUser -Organization $org | ?{$_.username -like &quot;*-adm*&quot;} # You can then loop through an array if you store the above command into a variable. Get-VBOLicensedUser -Organization $org |?{$_.username -like &quot;*-adm*&quot;}|foreach-object {remove-vbolicenseduser $_}  "},{"title":"Export AAD Secrets and Certs","type":0,"sectionRef":"#","url":"/docs/PowerShell/Export AAD Secrets and Certs","content":"Export AAD Secrets and Certs The script below was created originally by Microsoft, I will find the link where this came from. ################################################################################# #DISCLAIMER: This is not an official PowerShell Script. We designed it specifically for the situation you have encountered right now. #Please do not modify or change any preset parameters. #Please note that we will not be able to support the script if it is changed or altered in any way or used in a different situation for other means. #This code-sample is provided &quot;AS IT IS&quot; without warranty of any kind, either expressed or implied, including but not limited to the implied warranties of merchantability and/or fitness for a particular purpose. #This sample is not supported under any Microsoft standard support program or service.. #Microsoft further disclaims all implied warranties including, without limitation, any implied warranties of merchantability or of fitness for a particular purpose. #The entire risk arising out of the use or performance of the sample and documentation remains with you. #In no event shall Microsoft, its authors, or anyone else involved in the creation, production, or delivery of the script be liable for any damages whatsoever (including, without limitation, damages for loss of business profits, business interruption, loss of business information, or other pecuniary loss) arising out of the use of or inability to use the sample or documentation, even if Microsoft has been advised of the possibility of such damages. ################################################################################# Connect-AzureAD $Applications = Get-AzureADApplication -all $true $Logs = @() foreach ($app in $Applications) { $AppName = $app.DisplayName $AppID = $app.objectid $ApplID = $app.AppId $AppCreds = Get-AzureADApplication -ObjectId $AppID | Select-Object PasswordCredentials, KeyCredentials $secret = $AppCreds.PasswordCredentials $cert = $AppCreds.KeyCredentials ############################################ $Log = New-Object System.Object $Log | Add-Member -MemberType NoteProperty -Name &quot;ApplicationName&quot; -Value $AppName $Log | Add-Member -MemberType NoteProperty -Name &quot;ApplicationID&quot; -Value $ApplID $Log | Add-Member -MemberType NoteProperty -Name &quot;Secret Start Date&quot; -Value $Null $Log | Add-Member -MemberType NoteProperty -Name &quot;Secret End Date&quot; -value $Null $Log | Add-Member -MemberType NoteProperty -Name &quot;Certificate Start Date&quot; -Value $Null $Log | Add-Member -MemberType NoteProperty -Name &quot;Certificate End Date&quot; -value $Null $Log | Add-Member -MemberType NoteProperty -Name &quot;Owner&quot; -Value $Null $Log | Add-Member -MemberType NoteProperty -Name &quot;Owner_ObjectID&quot; -value $Null $Logs += $Log ############################################ foreach ($s in $secret) { $StartDate = $s.StartDate $EndDate = $s.EndDate #$operation = $EndDate - $now #$ODays = $operation.Days $Owner = Get-AzureADApplicationOwner -ObjectId $app.ObjectId $Username = $Owner.UserPrincipalName -join &quot;;&quot; $OwnerID = $Owner.ObjectID -join &quot;;&quot; if ($owner.UserPrincipalName -eq $Null) { $Username = $Owner.DisplayName + &quot; **&lt;This is an Application&gt;**&quot; } if ($Owner.DisplayName -eq $null) { $Username = &quot;&lt;&lt;No Owner&gt;&gt;&quot; } $Log = New-Object System.Object $Log | Add-Member -MemberType NoteProperty -Name &quot;ApplicationName&quot; -Value $AppName $Log | Add-Member -MemberType NoteProperty -Name &quot;ApplicationID&quot; -Value $ApplID $Log | Add-Member -MemberType NoteProperty -Name &quot;Secret Start Date&quot; -Value $StartDate $Log | Add-Member -MemberType NoteProperty -Name &quot;Secret End Date&quot; -value $EndDate $Log | Add-Member -MemberType NoteProperty -Name &quot;Certificate Start Date&quot; -Value $Null $Log | Add-Member -MemberType NoteProperty -Name &quot;Certificate End Date&quot; -value $Null $Log | Add-Member -MemberType NoteProperty -Name &quot;Owner&quot; -Value $Username $Log | Add-Member -MemberType NoteProperty -Name &quot;Owner_ObjectID&quot; -value $OwnerID $Logs += $Log } foreach ($c in $cert) { $CStartDate = $c.StartDate $CEndDate = $c.EndDate #$COperation = $CEndDate - $now #$CODays = $COperation.Days $Owner = Get-AzureADApplicationOwner -ObjectId $app.ObjectId $Username = $Owner.UserPrincipalName -join &quot;;&quot; $OwnerID = $Owner.ObjectID -join &quot;;&quot; if ($owner.UserPrincipalName -eq $Null) { $Username = $Owner.DisplayName + &quot; **&lt;This is an Application&gt;**&quot; } if ($Owner.DisplayName -eq $null) { $Username = &quot;&lt;&lt;No Owner&gt;&gt;&quot; } $Log = New-Object System.Object $Log | Add-Member -MemberType NoteProperty -Name &quot;ApplicationName&quot; -Value $AppName $Log | Add-Member -MemberType NoteProperty -Name &quot;ApplicationID&quot; -Value $ApplID $Log | Add-Member -MemberType NoteProperty -Name &quot;Certificate Start Date&quot; -Value $CStartDate $Log | Add-Member -MemberType NoteProperty -Name &quot;Certificate End Date&quot; -value $CEndDate $Log | Add-Member -MemberType NoteProperty -Name &quot;Owner&quot; -Value $Username $Log | Add-Member -MemberType NoteProperty -Name &quot;Owner_ObjectID&quot; -value $OwnerID $Logs += $Log } } Write-host &quot;Add the Path you'd like us to export the CSV file to, in the format of &lt;C:\\Users\\&lt;USER&gt;\\Desktop\\Users.csv&gt;&quot; -ForegroundColor Green $Path = Read-Host $Logs | Export-CSV $Path -NoTypeInformation -Encoding UTF8 ","keywords":"IT  blog  Microsoft  Azure  Computers"}]